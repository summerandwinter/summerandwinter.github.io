<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Mac环境nginx实现图片裁剪和缓存 | Winter`s Notes</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="canonical" href="https://summerandwinter.github.io/build-nginx-with-image-filter-in-mac.html"><meta name="description" content="介绍在Mac环境下通过nginx搭建图片服务器的整个过程，并通过nginx的image-filter模块实现对图片简单裁剪和图片缓存"><meta name="keywords" content="Mac,nginx,image-filter"><meta property="og:type" content="article"><meta property="og:title" content="Mac环境nginx实现图片裁剪和缓存"><meta property="og:url" content="https://summerandwinter.github.io/build-nginx-with-image-filter-in-mac.html"><meta property="og:site_name" content="Winter`s Notes"><meta property="og:description" content="介绍在Mac环境下通过nginx搭建图片服务器的整个过程，并通过nginx的image-filter模块实现对图片简单裁剪和图片缓存"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-11-28T08:58:49.415Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Mac环境nginx实现图片裁剪和缓存"><meta name="twitter:description" content="介绍在Mac环境下通过nginx搭建图片服务器的整个过程，并通过nginx的image-filter模块实现对图片简单裁剪和图片缓存"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/gitment.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/article.css"></head></html><body><div id="container"><div id="wrap"><header id="header" class="header"><nav id="main-nav" class="main-nav"> <a class="main-nav-link" href="/">主页</a> <a class="main-nav-link" href="/archives">归档</a> <a class="main-nav-link" href="/category">分类</a> <a class="main-nav-link" href="/tag">标签</a></nav><nav id="sub-nav"></nav></header><div class="outer"><section id="main"><div class="article-container"><article id="post-build-nginx-with-image-filter-in-mac" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> Mac环境nginx实现图片裁剪和缓存</h1></header><div class="article-entry typo" itemprop="articleBody"><h1 id="安装tap"><a href="#安装tap" class="headerlink" title="安装tap"></a>安装tap</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew tap homebrew/nginx</span><br></pre></td></tr></table></figure><h1 id="安装gd"><a href="#安装gd" class="headerlink" title="安装gd"></a>安装gd</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install gd</span><br></pre></td></tr></table></figure><h1 id="安装nginx和image-filter模块"><a href="#安装nginx和image-filter模块" class="headerlink" title="安装nginx和image-filter模块"></a>安装nginx和image-filter模块</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install nginx-full --with-gd --with-image-filter</span><br></pre></td></tr></table></figure><h1 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8088;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        # 匹配 /img/image.jpg@500-500形式的链接</span><br><span class="line">        location ~ &quot;^/img/(?&lt;image&gt;.+)@(?&lt;width&gt;\d+)-(?&lt;height&gt;\d+)$&quot; &#123;</span><br><span class="line">        	# 定位到 /img/image.jpg</span><br><span class="line">            alias /usr/local/var/www/img/$image;</span><br><span class="line">            # 裁剪</span><br><span class="line">            image_filter crop $width $height;</span><br><span class="line">            image_filter_jpeg_quality 75;</span><br><span class="line">            image_filter_buffer 8M;</span><br><span class="line">            error_page   415 = /empty;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location = /empty &#123;</span><br><span class="line">            empty_gif;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 定义缓存目录</span><br><span class="line">    proxy_cache_path /usr/local/var/www/nginx-images-cache/ levels=1:2 keys_zone=images:10m inactive=24h max_size=100m;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        # Public-facing cache server.</span><br><span class="line">        listen       8888;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        # Only serve widths of 768 or 1920 so we can cache effectively.</span><br><span class="line">        location ~ &quot;^/img/(?&lt;image&gt;.+)@(?&lt;width&gt;\d+)-(?&lt;height&gt;\d+)$&quot; &#123;</span><br><span class="line">            # Proxy to internal image resizing server.</span><br><span class="line">            proxy_pass http://localhost:8088/img/$image@$width-$height;</span><br><span class="line">            proxy_cache images;</span><br><span class="line">            proxy_cache_valid 200 24h;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /img &#123;</span><br><span class="line">            # Nginx needs you to manually define DNS resolution when using</span><br><span class="line">            # variables in proxy_pass. Creating this dummy location avoids that.</span><br><span class="line">            # The error is: &quot;no resolver defined to resolve localhost&quot;.</span><br><span class="line">            proxy_pass http://localhost:8088/;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动nginx</p><p>访问<a href="http://localhost:8088/img/1.jpg@500-500" target="_blank" rel="noopener">http://localhost:8088/img/1.jpg@500-500</a>查看裁剪过的图片<br>访问<a href="http://localhost:8888/img/1.jpg@500-500" target="_blank" rel="noopener">http://localhost:8888/img/1.jpg@500-500</a>查看缓存效果</p><div class="end-of-file">END</div></div><footer class="article-footer"><ul class="article-meta"><li> <span class="label">发布:</span> <a href="/build-nginx-with-image-filter-in-mac.html" class="article-date"><time datetime="2018-01-06T22:29:09.000Z" itemprop="datePublished">2018-01-06</time></a></li><li> <span class="label">分类:</span><div class="article-category"> <a class="article-category-link" href="/category/nginx/">nginx</a></div></li><li> <span class="label">标签:</span><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Mac/">Mac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/image-filter/">image-filter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/nginx/">nginx</a></li></ul></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"> <a href="/chinese-copywriting-guidelines.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title"> 中文文案排版指南</div></a> <a href="/imagemagick-learning.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">ImageMagick学习</div></a></nav></article><aside id="article-toc" role="navigation" class="article-toc"><div id="article-toc-inner"> <strong class="sidebar-title">目录</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#安装tap"><span class="toc-text">安装tap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装gd"><span class="toc-text">安装gd</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装nginx和image-filter模块"><span class="toc-text">安装nginx和image-filter模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置nginx"><span class="toc-text">配置nginx</span></a></li></ol> <a href="#" id="article-toc-top">回到顶部</a></div></aside><section id="gitment_ccomments" class="comments"><div id="gitment_container"></div></section></div></section></div><footer id="footer" class="post-footer footer"><div id="footerContent" class="footer-content"><div class="end-of-file">Live Happy Love Hard</div></div></footer></div><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/gitment.js"></script><script>var date="Sat Jan 06 2018 22:29:09 GMT+0000",id=""+new Date(date).getTime(),gitment=new Gitment({id:id,owner:"summerandwinter",repo:"summerandwinter.github.io",oauth:{client_id:"7b432b7b46e71966fd88",client_secret:"2c697bec7b012bca975de41c87863d84086f8d81"}});gitment.render("gitment_container")</script><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/summer.js"></script><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--></div></body>