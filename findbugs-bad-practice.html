<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Findbugs整理:Bad Practice | Winter`s Notes</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="canonical" href="https://summerandwinter.github.io/findbugs-bad-practice.html"><meta name="description" content="整理一些 Findbugs 的 Bad practice 校验点知识"><meta name="keywords" content="Findbugs"><meta property="og:type" content="article"><meta property="og:title" content="Findbugs整理:Bad Practice"><meta property="og:url" content="https://summerandwinter.github.io/findbugs-bad-practice.html"><meta property="og:site_name" content="Winter`s Notes"><meta property="og:description" content="整理一些 Findbugs 的 Bad practice 校验点知识"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-11-28T08:58:49.415Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Findbugs整理:Bad Practice"><meta name="twitter:description" content="整理一些 Findbugs 的 Bad practice 校验点知识"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/gitment.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/article.css"></head></html><body><div id="container"><div id="wrap"><header id="header" class="header"><nav id="main-nav" class="main-nav"> <a class="main-nav-link" href="/">主页</a> <a class="main-nav-link" href="/archives">归档</a> <a class="main-nav-link" href="/category">分类</a> <a class="main-nav-link" href="/tag">标签</a></nav><nav id="sub-nav"></nav></header><div class="outer"><section id="main"><div class="article-container"><article id="post-findbugs-bad-practice" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> Findbugs整理:Bad Practice</h1></header><div class="article-entry typo" itemprop="articleBody"><hr><h1 id="Bad-practice"><a href="#Bad-practice" class="headerlink" title="Bad practice"></a>Bad practice</h1><h1 id="不好的习惯"><a href="#不好的习惯" class="headerlink" title="不好的习惯"></a>不好的习惯</h1><h2 id="Equals-method-should-not-assume-anything-about-the-type-of-its-argument"><a href="#Equals-method-should-not-assume-anything-about-the-type-of-its-argument" class="headerlink" title="Equals method should not assume anything about the type of its argument"></a>Equals method should not assume anything about the type of its argument</h2><h2 id="实现类的equals方法时，不应该对参数有任何的预先设定"><a href="#实现类的equals方法时，不应该对参数有任何的预先设定" class="headerlink" title="实现类的equals方法时，不应该对参数有任何的预先设定"></a>实现类的equals方法时，不应该对参数有任何的预先设定</h2><p>BC_EQUALS_METHOD_SHOULD_WORK_FOR_ALL_OBJECTS<br>The equals(Object o) method shouldn’t make any assumptions about the type of o. It should simply return false if o is not the same type as this.</p><p>实现类的 <code>equals(Object o)</code> 方法时，不应该对参数有任何的预先设定,如果 <code>o</code> 的类型不是当前类的类型时应该直接返回 <code>false</code>。</p><p>案例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">   <span class="comment">// some code</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">     Foo other = (Foo) o;</span><br><span class="line">    <span class="comment">// the real equals code</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改进方案</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">   <span class="comment">// some code</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Foo )&#123;</span><br><span class="line">       <span class="comment">// the real equals code</span></span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果直接设定参数o肯定是Foo类的一个对象，在函数调用时，如果参数 <code>o</code> 不是一个 <code>Foo</code> 类或其子类，就会导致代码会抛出一个 <code>ClassCastException</code> 。因此在实现 <code>equals</code> 方法，应该加一个判断，如果参数 <code>o</code> 不是一个 <code>Foo</code> 类对象，则返回 <code>false</code>。</p><h2 id="Check-for-sign-of-bitwise-operation"><a href="#Check-for-sign-of-bitwise-operation" class="headerlink" title="Check for sign of bitwise operation"></a>Check for sign of bitwise operation</h2><h2 id="检查位操作符运行是否合理"><a href="#检查位操作符运行是否合理" class="headerlink" title="检查位操作符运行是否合理"></a>检查位操作符运行是否合理</h2><p>BIT_SIGNED_CHECK</p><p>案例<br></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">((event.detail &amp; SWT.SELECTED) &gt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p></p><p>上面的案例判断语句中使用了位操作，并且进行了 <code>&gt;0</code> 的比较。这个语句的本意应该是两个数字进行与操作后是否还有非0的位数，但是如果与操作后的结果为负数时就会变成一个 BUG , 最好用 <code>!=0</code> 替换 <code>&gt;0</code>。</p><h2 id="Class-implements-Cloneable-but-does-not-define-or-use-clone-method"><a href="#Class-implements-Cloneable-but-does-not-define-or-use-clone-method" class="headerlink" title="Class implements Cloneable but does not define or use clone method"></a>Class implements Cloneable but does not define or use clone method</h2><h2 id="类实现了-Cloneable-接口但是没有声明或使用到-clone-方法"><a href="#类实现了-Cloneable-接口但是没有声明或使用到-clone-方法" class="headerlink" title="类实现了 Cloneable 接口但是没有声明或使用到 clone 方法"></a>类实现了 <code>Cloneable</code> 接口但是没有声明或使用到 <code>clone</code> 方法</h2><p>CN_IDIOM</p><p>按照惯例，实现此接口的类应该使用公共方法重写 Object.clone（它是受保护的），以获得有关重写此方法的详细信息。因为 <code>clone</code> 方法是 <code>Object</code> 类的方法，所以当前类不去声明这个方法，不会编译不通过。但是，<code>clone</code> 是需要逐个字段去复制的，所以没有声明<code>clone</code> 方法是不对的。</p><h2 id="clone-method-does-not-call-super-clone"><a href="#clone-method-does-not-call-super-clone" class="headerlink" title="clone method does not call super.clone()"></a>clone method does not call super.clone()</h2><h2 id="clone-方法中没有调用-super-clone-方法"><a href="#clone-方法中没有调用-super-clone-方法" class="headerlink" title="clone 方法中没有调用 super.clone() 方法"></a>clone 方法中没有调用 super.clone() 方法</h2><p>CN_IDIOM_NO_SUPER_CALL</p><p>This non-final class defines a clone() method that does not call super.clone(). If this class (“A”) is extended by a subclass (“B”), and the subclass B calls super.clone(), then it is likely that B’s clone() method will return an object of type A, which violates the standard contract for clone().</p><p>If all clone() methods call super.clone(), then they are guaranteed to use Object.clone(), which always returns an object of the correct type.</p><p>非final的类，定义了clone()方法，却在方法中没有调用super.clone()。<br>看上去，不应该调用super.clone()。如果A是B的父类，那么B调用super.clone()，则B的clone方法返回的是A的实例，看上去是错的。<br>但是，如果所有的clone()方法都调用了super.clone()，则最终调用的是Object.clone()，那就能返回正确的类型。</p><h2 id="CN-IMPLEMENTS-CLONE-BUT-NOT-CLONEABLE"><a href="#CN-IMPLEMENTS-CLONE-BUT-NOT-CLONEABLE" class="headerlink" title="CN_IMPLEMENTS_CLONE_BUT_NOT_CLONEABLE"></a>CN_IMPLEMENTS_CLONE_BUT_NOT_CLONEABLE</h2><blockquote><p>Class defines clone() but doesn’t implement Cloneable<br>类定义了clone()方法，但是没有声明实现Cloneable接口</p></blockquote><p>This class defines a clone() method but the class doesn’t implement Cloneable. There are some situations in which this is OK (e.g., you want to control how subclasses can clone themselves), but just make sure that this is what you intended.</p><p>这个不是个什麽大问题，只是确认一下是不是漏了声明。</p><div class="end-of-file">END</div></div><footer class="article-footer"><ul class="article-meta"><li> <span class="label">发布:</span> <a href="/findbugs-bad-practice.html" class="article-date"><time datetime="2018-07-23T17:10:57.000Z" itemprop="datePublished">2018-07-23</time></a></li><li> <span class="label">分类:</span><div class="article-category"> <a class="article-category-link" href="/category/Findbugs/">Findbugs</a></div></li><li> <span class="label">标签:</span><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Findbugs/">Findbugs</a></li></ul></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"> <a href="/findbugs-malicious-code-vulnerrability.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title"> Findbugs整理:Malicious Code Vulnerrability</div></a> <a href="/chinese-copywriting-guidelines.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">中文文案排版指南</div></a></nav></article><aside id="article-toc" role="navigation" class="article-toc"><div id="article-toc-inner"> <strong class="sidebar-title">目录</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Bad-practice"><span class="toc-text">Bad practice</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#不好的习惯"><span class="toc-text">不好的习惯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Equals-method-should-not-assume-anything-about-the-type-of-its-argument"><span class="toc-text">Equals method should not assume anything about the type of its argument</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现类的equals方法时，不应该对参数有任何的预先设定"><span class="toc-text">实现类的equals方法时，不应该对参数有任何的预先设定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Check-for-sign-of-bitwise-operation"><span class="toc-text">Check for sign of bitwise operation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查位操作符运行是否合理"><span class="toc-text">检查位操作符运行是否合理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Class-implements-Cloneable-but-does-not-define-or-use-clone-method"><span class="toc-text">Class implements Cloneable but does not define or use clone method</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类实现了-Cloneable-接口但是没有声明或使用到-clone-方法"><span class="toc-text">类实现了 Cloneable 接口但是没有声明或使用到 clone 方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#clone-method-does-not-call-super-clone"><span class="toc-text">clone method does not call super.clone()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#clone-方法中没有调用-super-clone-方法"><span class="toc-text">clone 方法中没有调用 super.clone() 方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CN-IMPLEMENTS-CLONE-BUT-NOT-CLONEABLE"><span class="toc-text">CN_IMPLEMENTS_CLONE_BUT_NOT_CLONEABLE</span></a></li></ol></li></ol> <a href="#" id="article-toc-top">回到顶部</a></div></aside><section id="gitment_ccomments" class="comments"><div id="gitment_container"></div></section></div></section></div><footer id="footer" class="post-footer footer"><div id="footerContent" class="footer-content"><div class="end-of-file">Live Happy Love Hard</div></div></footer></div><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/gitment.js"></script><script>var date="Mon Jul 23 2018 17:10:57 GMT+0000",id=""+new Date(date).getTime(),gitment=new Gitment({id:id,owner:"summerandwinter",repo:"summerandwinter.github.io",oauth:{client_id:"7b432b7b46e71966fd88",client_secret:"2c697bec7b012bca975de41c87863d84086f8d81"}});gitment.render("gitment_container")</script><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/summer.js"></script><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--></div></body>