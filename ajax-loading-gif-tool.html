<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Ajaxload动态加载动画生成工具的实现（ajaxload的本地移植） | Winter`s Notes</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="canonical" href="https://summerandwinter.github.io/ajax-loading-gif-tool.html"><meta name="description" content="前言前段时间看到一个[国外的网站][website]，在线生成ajax loading动画。觉得很实用，于是动起了移植到自己网站的念头（一直以来的习惯，看到好的工具总想着移植到本地好好研究）。根据以往移植的经验最终把这个工具移植到自己网站上了，生成图片的核心还是用了原来网站的接口，所以这个功能的实现完全依赖于原网站，生成和下载图片的速度取决于网速，由于是国外的网站，功能并不稳定。下面介绍下我移植的"><meta name="keywords" content="Ajax,Loading,动态加载"><meta property="og:type" content="article"><meta property="og:title" content="Ajaxload动态加载动画生成工具的实现（ajaxload的本地移植）"><meta property="og:url" content="https://summerandwinter.github.io/ajax-loading-gif-tool.html"><meta property="og:site_name" content="Winter`s Notes"><meta property="og:description" content="前言前段时间看到一个[国外的网站][website]，在线生成ajax loading动画。觉得很实用，于是动起了移植到自己网站的念头（一直以来的习惯，看到好的工具总想着移植到本地好好研究）。根据以往移植的经验最终把这个工具移植到自己网站上了，生成图片的核心还是用了原来网站的接口，所以这个功能的实现完全依赖于原网站，生成和下载图片的速度取决于网速，由于是国外的网站，功能并不稳定。下面介绍下我移植的"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-11-28T08:58:49.415Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Ajaxload动态加载动画生成工具的实现（ajaxload的本地移植）"><meta name="twitter:description" content="前言前段时间看到一个[国外的网站][website]，在线生成ajax loading动画。觉得很实用，于是动起了移植到自己网站的念头（一直以来的习惯，看到好的工具总想着移植到本地好好研究）。根据以往移植的经验最终把这个工具移植到自己网站上了，生成图片的核心还是用了原来网站的接口，所以这个功能的实现完全依赖于原网站，生成和下载图片的速度取决于网速，由于是国外的网站，功能并不稳定。下面介绍下我移植的"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/gitment.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/article.css"></head></html><body><div id="container"><div id="wrap"><header id="header" class="header"><nav id="main-nav" class="main-nav"> <a class="main-nav-link" href="/">主页</a> <a class="main-nav-link" href="/archives">归档</a> <a class="main-nav-link" href="/category">分类</a> <a class="main-nav-link" href="/tag">标签</a></nav><nav id="sub-nav"></nav></header><div class="outer"><section id="main"><div class="article-container"><article id="post-ajax-loading-gif-tool" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> Ajaxload动态加载动画生成工具的实现（ajaxload的本地移植）</h1></header><div class="article-entry typo" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前段时间看到一个[国外的网站][website]，在线生成ajax loading动画。觉得很实用，于是动起了移植到自己网站的念头（一直以来的习惯，看到好的工具总想着移植到本地好好研究）。根据以往移植的经验最终把这个工具移植到自己网站上了，生成图片的核心还是用了原来网站的接口，所以这个功能的实现完全依赖于原网站，生成和下载图片的速度取决于网速，由于是国外的网站，功能并不稳定。下面介绍下我移植的过程已经遇到的问题。<br><a id="more"></a><br>[website]: <a href="http://www.ajaxload.info/" target="_blank" rel="noopener">http://www.ajaxload.info/</a> “ajaxinfo”</p><h1 id="把原网站的代码本地化"><a href="#把原网站的代码本地化" class="headerlink" title="把原网站的代码本地化"></a>把原网站的代码本地化</h1><p>这一步比较简单，不过有点麻烦，相关的图片，css,js，html文件保存在本地。</p><h1 id="实现生成图片的功能"><a href="#实现生成图片的功能" class="headerlink" title="实现生成图片的功能"></a>实现生成图片的功能</h1><p>这里遇到了第一个问题，网站生成的图片保存在根据颜色值生成的途径上，而这些图片有防盗链设置，不 允许外来网站引用。尝试过写程序把网站上的所有图片按原目录下载到本地，但是图片太多，放弃了这个思路。</p><p>最后采取的办法是通过伪造来源访问原网站的图片，获取图片数据，并直接输出在页面。</p><p>下面是实现的代码</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$file=$_REQUEST[‘file’];</span><br><span class="line">$url = ‘http:<span class="comment">//www.ajaxload.info/‘.$file;</span></span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">curl_setopt ($ch, CURLOPT_HEADER,<span class="number">0</span>);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">curl_setopt ($ch, CURLOPT_REFERER, “http:<span class="comment">//www.ajaxload.info“);</span></span><br><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">$chData = curl_exec($ch);</span><br><span class="line"><span class="keyword">if</span> (curl_errno($ch)) &#123;</span><br><span class="line"><span class="keyword">echo</span> ‘Curl error: ‘ . curl_error($ch);</span><br><span class="line">&#125;</span><br><span class="line">curl_close($ch);</span><br><span class="line">header(“Content-type:image/gif”);</span><br><span class="line"><span class="keyword">echo</span> $chData;</span><br></pre></td></tr></table></figure><blockquote><p>注：本人的网站基于BAE建设，与其他服务器的伪造来源有些区别</p></blockquote><p>其他服务器需把</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>替换成</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>把上述代码保存为ajaxload.php文件<strong>用下面的代码</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> url = ‘http:<span class="comment">//laotou.sinaapp.com/ajaxloader.php?file=cache/‘+c1+’/‘+c2+’/‘+c3+’/‘+c4+’/‘+c5+’/‘+c6+’/‘+$$(‘type’).value+’-‘+trans+’.gif’;</span></span><br></pre></td></tr></table></figure><blockquote><p>注：<code>http://laotou.sinaapp.com</code> 替换成你自己的ajaxloader.php文件的地址。</p></blockquote><p>替换原网站script.js文件中的</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> url = ‘cache/‘+c1+’/‘+c2+’/‘+c3+’/‘+c4+’/‘+c5+’/‘+c6+’/‘+$(‘type’).value+’-‘+trans+’.gif’;</span><br></pre></td></tr></table></figure><h1 id="实现图片下载"><a href="#实现图片下载" class="headerlink" title="实现图片下载"></a>实现图片下载</h1><p>同样的原因，原网站的下载功能移植到本地后也不能用了，实现的方法与生成图片的方法类似</p><p>代码如下</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[url]))&#123;</span><br><span class="line">$file=$_GET[url];<span class="comment">//获取参数</span></span><br><span class="line">header(“Content-Type: application/force-download”);</span><br><span class="line">header(“Content-Disposition: attachment; filename=ajax-loading.gif”);<span class="comment">//$downname是下载后的文件名</span></span><br><span class="line">$file=$_REQUEST[‘url’];</span><br><span class="line">$url = ‘http:<span class="comment">//www.ajaxload.info/‘.$file;</span></span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">curl_setopt ($ch, CURLOPT_HEADER,<span class="number">0</span>);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">curl_setopt ($ch, CURLOPT_REFERER, “http:<span class="comment">//www.ajaxload.info“);</span></span><br><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">$chData = curl_exec($ch);</span><br><span class="line"><span class="keyword">if</span> (curl_errno($ch)) &#123;</span><br><span class="line"><span class="keyword">echo</span> ‘Curl error: ‘ . curl_error($ch);</span><br><span class="line">&#125;</span><br><span class="line">curl_close($ch);</span><br><span class="line"><span class="keyword">echo</span> $chData;</span><br><span class="line"><span class="keyword">exit</span>;<span class="comment">//结束程序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：<code>http://laotou.sinaapp.com</code> 替换成你自己的ajaxloader.php文件的地址。</p></blockquote><div class="end-of-file">END</div></div><footer class="article-footer"><ul class="article-meta"><li> <span class="label">发布:</span> <a href="/ajax-loading-gif-tool.html" class="article-date"><time datetime="2013-11-06T16:11:30.000Z" itemprop="datePublished">2013-11-06</time></a></li><li> <span class="label">分类:</span><div class="article-category"> <a class="article-category-link" href="/category/前端设计/">前端设计</a></div></li><li> <span class="label">标签:</span><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Ajax/">Ajax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Loading/">Loading</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/动态加载/">动态加载</a></li></ul></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"> <a href="/some-mysql-code.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title"> 一些MySQL代码片段</div></a> <a href="/image-filters-by-canvas-video.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">用Canvas实现图片滤镜效果详解之视频效果</div></a></nav></article><aside id="article-toc" role="navigation" class="article-toc"><div id="article-toc-inner"> <strong class="sidebar-title">目录</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#把原网站的代码本地化"><span class="toc-text">把原网站的代码本地化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现生成图片的功能"><span class="toc-text">实现生成图片的功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现图片下载"><span class="toc-text">实现图片下载</span></a></li></ol> <a href="#" id="article-toc-top">回到顶部</a></div></aside><section id="gitment_ccomments" class="comments"><div id="gitment_container"></div></section></div></section></div><footer id="footer" class="post-footer footer"><div id="footerContent" class="footer-content"><div class="end-of-file">Live Happy Love Hard</div></div></footer></div><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/gitment.js"></script><script>var date="Wed Nov 06 2013 16:11:30 GMT+0000",id=""+new Date(date).getTime(),gitment=new Gitment({id:id,owner:"summerandwinter",repo:"summerandwinter.github.io",oauth:{client_id:"7b432b7b46e71966fd88",client_secret:"2c697bec7b012bca975de41c87863d84086f8d81"}});gitment.render("gitment_container")</script><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/summer.js"></script><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--></div></body>