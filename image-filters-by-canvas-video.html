<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>用Canvas实现图片滤镜效果详解之视频效果 | Winter`s Notes</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="canonical" href="https://summerandwinter.github.io/image-filters-by-canvas-video.html"><meta name="description" content="这是一个很有意思的特效，模拟摄像机拍摄电视屏幕画面时出现点状颗粒的效果。颗粒的大小通过变换矩阵实现，可以任意调节，有兴趣研究的朋友可以尝试更多的效果，代码没有经过优化，只是一个粗糙的Demo，大家可以自行改进。"><meta name="keywords" content="HTML5,JavaScript,Canvas,图像滤镜,滤镜,视频滤镜"><meta property="og:type" content="article"><meta property="og:title" content="用Canvas实现图片滤镜效果详解之视频效果"><meta property="og:url" content="https://summerandwinter.github.io/image-filters-by-canvas-video.html"><meta property="og:site_name" content="Winter`s Notes"><meta property="og:description" content="这是一个很有意思的特效，模拟摄像机拍摄电视屏幕画面时出现点状颗粒的效果。颗粒的大小通过变换矩阵实现，可以任意调节，有兴趣研究的朋友可以尝试更多的效果，代码没有经过优化，只是一个粗糙的Demo，大家可以自行改进。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/original.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/video.jpg"><meta property="og:updated_time" content="2019-11-28T08:58:49.415Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="用Canvas实现图片滤镜效果详解之视频效果"><meta name="twitter:description" content="这是一个很有意思的特效，模拟摄像机拍摄电视屏幕画面时出现点状颗粒的效果。颗粒的大小通过变换矩阵实现，可以任意调节，有兴趣研究的朋友可以尝试更多的效果，代码没有经过优化，只是一个粗糙的Demo，大家可以自行改进。"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/original.jpg"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/gitment.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/article.css"></head></html><body><div id="container"><div id="wrap"><header id="header" class="header"><nav id="main-nav" class="main-nav"> <a class="main-nav-link" href="/">主页</a> <a class="main-nav-link" href="/archives">归档</a> <a class="main-nav-link" href="/category">分类</a> <a class="main-nav-link" href="/tag">标签</a></nav><nav id="sub-nav"></nav></header><div class="outer"><section id="main"><div class="article-container"><article id="post-image-filters-by-canvas-video" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> 用Canvas实现图片滤镜效果详解之视频效果</h1></header><div class="article-entry typo" itemprop="articleBody"><p>这是一个很有意思的特效，模拟摄像机拍摄电视屏幕画面时出现点状颗粒的效果。颗粒的大小通过变换矩阵实现，可以任意调节，有兴趣研究的朋友可以尝试更多的效果，代码没有经过优化，只是一个粗糙的Demo，大家可以自行改进。<br><a id="more"></a></p><h1 id="获取图像数据"><a href="#获取图像数据" class="headerlink" title="获取图像数据"></a>获取图像数据</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">img.src = ’original.jpg’;  </span><br><span class="line">canvas.width = img.width;  </span><br><span class="line">canvas.height = img.height;  </span><br><span class="line"><span class="keyword">var</span> context = canvas.getContext(“<span class="number">2</span>d”);  </span><br><span class="line">context.drawImage(img, <span class="number">0</span>, <span class="number">0</span>);  </span><br><span class="line"><span class="keyword">var</span> canvasData = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br></pre></td></tr></table></figure><h1 id="设置过滤矩阵"><a href="#设置过滤矩阵" class="headerlink" title="设置过滤矩阵"></a>设置过滤矩阵</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> m_VideoType=<span class="number">0</span>;  </span><br><span class="line">       <span class="keyword">var</span> pattern=<span class="keyword">new</span> <span class="built_in">Array</span>();  </span><br><span class="line">       <span class="keyword">switch</span> (m_VideoType)  </span><br><span class="line">       &#123;  </span><br><span class="line">           case0:<span class="comment">//VIDEOTYPE.VIDEOSTAGGERED:  </span></span><br><span class="line">           &#123;  </span><br><span class="line">               pattern = [  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">0</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">0</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">1</span>,  </span><br><span class="line">               ];  </span><br><span class="line">               <span class="keyword">break</span>;  </span><br><span class="line">           &#125;  </span><br><span class="line">           case1:<span class="comment">//VIDEOTYPE.VIDEOTRIPED:  </span></span><br><span class="line">           &#123;  </span><br><span class="line">               pattern = [    </span><br><span class="line">                   <span class="number">0</span>,  </span><br><span class="line">                   <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">2</span>,  </span><br><span class="line">               ];  </span><br><span class="line">               <span class="keyword">break</span>;  </span><br><span class="line">           &#125;  </span><br><span class="line">           case2:<span class="comment">//VIDEOTYPE.VIDEO3X3:  </span></span><br><span class="line">           &#123;  </span><br><span class="line">               pattern =  </span><br><span class="line">               [  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>,  </span><br><span class="line">               ];  </span><br><span class="line">               <span class="keyword">break</span>;  </span><br><span class="line">           &#125;  </span><br><span class="line">           <span class="keyword">default</span>:  </span><br><span class="line">           &#123;  </span><br><span class="line">               pattern =  </span><br><span class="line">               [  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>,  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>,  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>,  </span><br><span class="line">                   <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>,  </span><br><span class="line">               ];  </span><br><span class="line">               <span class="keyword">break</span>;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="keyword">var</span> pattern_width = [ <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span> ];  </span><br><span class="line">       <span class="keyword">var</span> pattern_height = [<span class="number">6</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">15</span> ];</span><br></pre></td></tr></table></figure><h1 id="获取过滤数据"><a href="#获取过滤数据" class="headerlink" title="获取过滤数据"></a>获取过滤数据</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> ( <span class="keyword">var</span> x = <span class="number">0</span>; x &lt; canvasData.width; x++) &#123;    </span><br><span class="line">         <span class="keyword">for</span> ( <span class="keyword">var</span> y = <span class="number">0</span>; y &lt; canvasData.height; y++) &#123;    </span><br><span class="line">        </span><br><span class="line">           <span class="comment">// Index of the pixel in the array    </span></span><br><span class="line">           <span class="keyword">var</span> idx = (x + y  canvasData.width)  <span class="number">4</span>;    </span><br><span class="line">           <span class="keyword">var</span> r = canvasData.data[idx + <span class="number">0</span>];    </span><br><span class="line">           <span class="keyword">var</span> g = canvasData.data[idx + <span class="number">1</span>];    </span><br><span class="line">           <span class="keyword">var</span> b = canvasData.data[idx + <span class="number">2</span>];    </span><br><span class="line">              <span class="keyword">var</span> nWidth = patternwidth[mVideoType];  </span><br><span class="line">              <span class="keyword">var</span> nHeight = patternheight[mVideoType];  </span><br><span class="line">              <span class="keyword">var</span> index = nWidth * (y % nHeight) + (x % nWidth);  </span><br><span class="line">  </span><br><span class="line">              index = pattern[index];  </span><br><span class="line">              <span class="keyword">if</span> (index == <span class="number">0</span>)  </span><br><span class="line">               <span class="keyword">var</span>   r = fclamp0255(<span class="number">2</span> * r);  </span><br><span class="line">              <span class="keyword">if</span> (index == <span class="number">1</span>)  </span><br><span class="line">               <span class="keyword">var</span>   g = fclamp0255(<span class="number">2</span> * g);  </span><br><span class="line">              <span class="keyword">if</span> (index == <span class="number">2</span>)  </span><br><span class="line">               <span class="keyword">var</span>   b = fclamp0255(<span class="number">2</span> * b);  </span><br><span class="line">                    </span><br><span class="line">            <span class="comment">// assign gray scale value    </span></span><br><span class="line">            canvasData.data[idx + <span class="number">0</span>] = r; <span class="comment">// Red channel    </span></span><br><span class="line">            canvasData.data[idx + <span class="number">1</span>] = g; <span class="comment">// Green channel    </span></span><br><span class="line">            canvasData.data[idx + <span class="number">2</span>] = b; <span class="comment">// Blue channel    </span></span><br><span class="line">            canvasData.data[idx + <span class="number">3</span>] = <span class="number">255</span>; <span class="comment">// Alpha channel    </span></span><br><span class="line">            <span class="comment">// 加上黑色的边框    </span></span><br><span class="line">            <span class="keyword">if</span>(x &lt; <span class="number">8</span> || y &lt; <span class="number">8</span> || x &gt; (canvasData.width - <span class="number">8</span>) || y &gt; (canvasData.height - <span class="number">8</span>))     </span><br><span class="line">            &#123;    </span><br><span class="line">              canvasData.data[idx + <span class="number">0</span>] = <span class="number">0</span>;    </span><br><span class="line">              canvasData.data[idx + <span class="number">1</span>] = <span class="number">0</span>;    </span><br><span class="line">              canvasData.data[idx + <span class="number">2</span>] = <span class="number">0</span>;    </span><br><span class="line">            &#125;    </span><br><span class="line">         &#125;    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="写入过滤后的数据"><a href="#写入过滤后的数据" class="headerlink" title="写入过滤后的数据"></a>写入过滤后的数据</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">context.putImageData(canvasData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><h1 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h1><p><strong>原图</strong></p><p><img src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/original.jpg" alt="原图"></p><p><strong>效果图</strong></p><p><img src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/video.jpg" alt="效果图"></p><p>查看<strong><a href="/lab/filters/video.html">示例</a></strong></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://github.com/daizhenjun/ImageFilterForAndroid" target="_blank" rel="noopener">代震军ImageFilter开源项目</a></p><div class="end-of-file">END</div></div><footer class="article-footer"><ul class="article-meta"><li> <span class="label">发布:</span> <a href="/image-filters-by-canvas-video.html" class="article-date"><time datetime="2013-11-04T23:24:54.000Z" itemprop="datePublished">2013-11-04</time></a></li><li> <span class="label">分类:</span><div class="article-category"> <a class="article-category-link" href="/category/前端设计/">前端设计</a></div></li><li> <span class="label">标签:</span><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Canvas/">Canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/HTML5/">HTML5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/图像滤镜/">图像滤镜</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/滤镜/">滤镜</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/视频滤镜/">视频滤镜</a></li></ul></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"> <a href="/ajax-loading-gif-tool.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title"> Ajaxload动态加载动画生成工具的实现（ajaxload的本地移植）</div></a> <a href="/image-filters-by-canvas-gray.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">用Canvas实现图片滤镜效果详解之灰度效果</div></a></nav></article><aside id="article-toc" role="navigation" class="article-toc"><div id="article-toc-inner"> <strong class="sidebar-title">目录</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#获取图像数据"><span class="toc-text">获取图像数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#设置过滤矩阵"><span class="toc-text">设置过滤矩阵</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#获取过滤数据"><span class="toc-text">获取过滤数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#写入过滤后的数据"><span class="toc-text">写入过滤后的数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#效果预览"><span class="toc-text">效果预览</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol> <a href="#" id="article-toc-top">回到顶部</a></div></aside><section id="gitment_ccomments" class="comments"><div id="gitment_container"></div></section></div></section></div><footer id="footer" class="post-footer footer"><div id="footerContent" class="footer-content"><div class="end-of-file">Live Happy Love Hard</div></div></footer></div><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/gitment.js"></script><script>var date="Mon Nov 04 2013 23:24:54 GMT+0000",id=""+new Date(date).getTime(),gitment=new Gitment({id:id,owner:"summerandwinter",repo:"summerandwinter.github.io",oauth:{client_id:"7b432b7b46e71966fd88",client_secret:"2c697bec7b012bca975de41c87863d84086f8d81"}});gitment.render("gitment_container")</script><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/summer.js"></script><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--></div></body>