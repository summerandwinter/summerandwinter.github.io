<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Findbugs整理:Malicious Code Vulnerrability | Winter`s Notes</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="canonical" href="https://summerandwinter.github.io/findbugs-malicious-code-vulnerrability.html"><meta name="description" content="整理一些 Findbugs 的 Malicious Code Vulnerrability 校验点知识"><meta name="keywords" content="Findbugs"><meta property="og:type" content="article"><meta property="og:title" content="Findbugs整理:Malicious Code Vulnerrability"><meta property="og:url" content="https://summerandwinter.github.io/findbugs-malicious-code-vulnerrability.html"><meta property="og:site_name" content="Winter`s Notes"><meta property="og:description" content="整理一些 Findbugs 的 Malicious Code Vulnerrability 校验点知识"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-11-28T08:58:49.415Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Findbugs整理:Malicious Code Vulnerrability"><meta name="twitter:description" content="整理一些 Findbugs 的 Malicious Code Vulnerrability 校验点知识"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/gitment.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/article.css"></head></html><body><div id="container"><div id="wrap"><header id="header" class="header"><nav id="main-nav" class="main-nav"> <a class="main-nav-link" href="/">主页</a> <a class="main-nav-link" href="/archives">归档</a> <a class="main-nav-link" href="/category">分类</a> <a class="main-nav-link" href="/tag">标签</a></nav><nav id="sub-nav"></nav></header><div class="outer"><section id="main"><div class="article-container"><article id="post-findbugs-malicious-code-vulnerrability" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> Findbugs整理:Malicious Code Vulnerrability</h1></header><div class="article-entry typo" itemprop="articleBody"><blockquote><p>如果代码公开，可能受到恶意攻击的代码</p></blockquote><h1 id="EI-EXPOSE-REP2"><a href="#EI-EXPOSE-REP2" class="headerlink" title="EI_EXPOSE_REP2"></a>EI_EXPOSE_REP2</h1><blockquote><p>May expose internal representation by incorporating reference to mutable object<br>引用可变对象可能会暴露内部的实现</p></blockquote><p>This code stores a reference to an externally mutable object into the internal representation of the object. If instances are accessed by untrusted code, and unchecked changes to the mutable object would compromise security or other important properties, you will need to do something different. Storing a copy of the object is better approach in many situations.</p><p>代码中对象中包含一个可变的引用类型属性，如果实例是由不受信任的代码访问，或者对可变对象做出未经检查的修改可能会导致安全问题。因此代码要做出一些修改比如：通常情况下引用这个对象的副本更好。</p><p>案例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pen</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.createTime;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(Date createTime)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.createTime = createTime;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Date date = <span class="keyword">new</span> Date(<span class="number">1538323200000L</span>); <span class="comment">// Mon Oct 01 00:00:00 CST 2018</span></span><br><span class="line">    System.out.println(date);</span><br><span class="line">    Pen pen = <span class="keyword">new</span> Pen();</span><br><span class="line">    pen.setCreateTime(date);</span><br><span class="line">    date.setTime(<span class="number">1506787200000L</span>); <span class="comment">// Sun Oct 01 00:00:00 CST 2017</span></span><br><span class="line">    System.out.println(date);</span><br><span class="line">    System.out.println(pen.getCreateTime());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Mon Oct 01 00:00:00 CST 2018</span><br><span class="line">Sun Oct 01 00:00:00 CST 2017</span><br><span class="line">Sun Oct 01 00:00:00 CST 2017</span><br></pre></td></tr></table></figure><p>由此能发现 <code>date</code> 改变时 <code>pen</code> 中的 <code>createTime</code> 也跟着变了，因为 Java 中非基本类型都是通过引用传递</p><p>改进方案</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (createTime != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Date(<span class="keyword">this</span>.createTime.getTime());</span><br><span class="line">      <span class="comment">//or</span></span><br><span class="line">      <span class="comment">//return (Date)this.createTime.clone()</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(Date createTime)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (createTime != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.createTime = <span class="keyword">new</span> Date(createTime.getTime());</span><br><span class="line">      <span class="comment">// or</span></span><br><span class="line">      <span class="comment">// this.createTime = (Date)createTime.clone();</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.createTime = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>setCreateTime</code> 时不直接赋值，而是传入对象的一个副本。</p><h1 id="MS-PKGPROTECT"><a href="#MS-PKGPROTECT" class="headerlink" title="MS_PKGPROTECT"></a>MS_PKGPROTECT</h1><blockquote><p>Field should be package protected<br>静态字段要用 protected 修饰</p></blockquote><p>A mutable static field could be changed by malicious code or by accident. The field could be made package protected to avoid this vulnerability.</p><p><code>static</code> 修饰的字段如果时可变的容易被恶意代码或者自己无意的修改，为了避免这种风险这个字段需要用 <code>protected</code> 修饰</p><p>案例</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> DIGIT[] = &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>&#125;;</span><br></pre></td></tr></table></figure><p>改进方案</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> DIGIT[] = &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>&#125;;</span><br></pre></td></tr></table></figure><div class="end-of-file">END</div></div><footer class="article-footer"><ul class="article-meta"><li> <span class="label">发布:</span> <a href="/findbugs-malicious-code-vulnerrability.html" class="article-date"><time datetime="2018-07-23T21:41:17.000Z" itemprop="datePublished">2018-07-23</time></a></li><li> <span class="label">分类:</span><div class="article-category"> <a class="article-category-link" href="/category/Findbugs/">Findbugs</a></div></li><li> <span class="label">标签:</span><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Findbugs/">Findbugs</a></li></ul></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"> <a href="/mac-gerrit-gitlab.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title"> Mac 环境下部署gerrit并与gitlab集成</div></a> <a href="/findbugs-bad-practice.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">Findbugs整理:Bad Practice</div></a></nav></article><aside id="article-toc" role="navigation" class="article-toc"><div id="article-toc-inner"> <strong class="sidebar-title">目录</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#EI-EXPOSE-REP2"><span class="toc-text">EI_EXPOSE_REP2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MS-PKGPROTECT"><span class="toc-text">MS_PKGPROTECT</span></a></li></ol> <a href="#" id="article-toc-top">回到顶部</a></div></aside><section id="gitment_ccomments" class="comments"><div id="gitment_container"></div></section></div></section></div><footer id="footer" class="post-footer footer"><div id="footerContent" class="footer-content"><div class="end-of-file">Live Happy Love Hard</div></div></footer></div><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/gitment.js"></script><script>var date="Mon Jul 23 2018 21:41:17 GMT+0000",id=""+new Date(date).getTime(),gitment=new Gitment({id:id,owner:"summerandwinter",repo:"summerandwinter.github.io",oauth:{client_id:"7b432b7b46e71966fd88",client_secret:"2c697bec7b012bca975de41c87863d84086f8d81"}});gitment.render("gitment_container")</script><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/summer.js"></script><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--></div></body>