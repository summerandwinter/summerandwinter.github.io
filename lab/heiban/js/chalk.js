function chalkboard(){$("#chalkboard").remove(),$(".chalk").remove(),$("body").prepend('<div class="panel"><a class="link" target="_blank">Save</a></div>'),$("body").prepend('<img src="img/bg.png" id="pattern" width=50 height=50>'),$("body").prepend('<canvas id="chalkboard"></canvas>'),$("body").prepend('<div class="chalk"></div>');var c=document.getElementById("chalkboard");$("#chalkboard").css("width",$(window).width()),$("#chalkboard").css("height",$(window).height()),c.width=$(window).width(),c.height=$(window).height();var l=c.getContext("2d"),d=c.width,r=c.height,a=0,n=0,o=!1,t=!1,h=0,s=0;$("#chalkboard").css("cursor","none"),document.onselectstart=function(){return!1},l.fillStyle="rgba(255,255,255,0.5)",l.strokeStyle="rgba(255,255,255,0.5)",l.lineWidth=7,l.lineCap="round";var i=document.getElementById("pattern");function u(e,t){l.strokeStyle="rgba(255,255,255,"+(.4+.2*Math.random())+")",l.beginPath(),l.moveTo(h,s),l.lineTo(e,t),l.stroke();for(var a=Math.round(Math.sqrt(Math.pow(e-h,2)+Math.pow(t-s,2))/(5/7)),n=(e-h)/a,o=(t-s)/a,c=0;c<a;c++){var d=s+c*o,r=h+c*n+7*(Math.random()-.5)*1.2,i=d+7*(Math.random()-.5)*1.2;l.clearRect(r,i,2*Math.random()+2,Math.random()+1)}h=e,s=t}function m(e,t){l.clearRect(e-25,t-50,50,100)}document.addEventListener("touchmove",function(e){var t=e.touches[0];a=t.pageX,(n=t.pageY)<r&&a<d&&(e.preventDefault(),$(".chalk").css("left",a+"px"),$(".chalk").css("top",n+"px"),o&&u(a,n))},!1),document.addEventListener("touchstart",function(e){var t=e.touches[0];o=!0,a=t.pageX,n=t.pageY,u((h=a)+1,(s=n)+1)},!1),document.addEventListener("touchend",function(e){o=!1},!1),$("#chalkboard").css("cursor","none"),l.fillStyle="rgba(255,255,255,0.5)",l.strokeStyle="rgba(255,255,255,0.5)",l.lineWidth=7,l.lineCap="round",$(document).mousemove(function(e){a=e.pageX,(n=e.pageY)<r&&a<d?($(".chalk").css("left",a-3.5+"px"),$(".chalk").css("top",n-3.5+"px"),o&&(t?m(a,n):u(a,n))):$(".chalk").css("top",r-10)}),$(document).mousedown(function(e){o=!0,h=a,s=n,2==e.button?(m(a,n),t=!0,$(".chalk").addClass("eraser")):$(".panel").is(":hover")||u(a+1,n+1)}),$(document).mouseup(function(e){o=!1,2==e.button&&(t=!1,$(".chalk").removeClass("eraser"))}),$(document).keyup(function(e){32==e.keyCode&&(l.clearRect(0,0,d,r),layPattern())}),$(document).keyup(function(e){83==e.keyCode&&changeLink()}),document.oncontextmenu=function(){return!1},$(".link").click(function(e){$(".download").remove();var t=document.createElement("canvas"),a=t.getContext("2d"),n=a.createPattern(i,"repeat");t.width=d,t.height=r,a.fillStyle=n,a.rect(0,0,d,r),a.fill();var o=new Image;o.src=c.toDataURL("image/png"),setTimeout(function(){a.drawImage(o,0,0);var e=t.toDataURL("image/png");$(".panel").append('<a href="'+e+'" download="chalkboard.png" class="download">Download</a>'),$(".download").click(function(){var t;t=e,setTimeout(function(){var e=window.open();$(e.document.body).html('<img src="'+t+'" name="chalkboard.png">')},500)})},500)}),$(window).resize(function(){chalkboard()})}$(document).ready(chalkboard);