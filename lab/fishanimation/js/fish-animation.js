!function(l){var m="fishAnimation",i=[],s=!1,r={fishImage:"assets/fish.png",fishFinImage:"assets/fin.png",spritesheetSpeed:1,colour:"#000",number:25,swimspeed:5,downspeed:.98,rounder:10,turning:3,scaleRange:3,swimTimer:50,canvasW:0,canvasH:0,scalePercent:1,manifest:[],fishArray:[],isLoaded:!1,browserSupport:!1,fishImageW:46,fishImageH:102,fishImageRegX:7,fishImageRegY:20,fishFinImageW:12,fishFinImageH:14,fishFinImageRegX:16,fishFinImageRegY:12,interact:!0};function h(e){return e+Math.floor(Math.random()*(e/3))}l.fn[m]=function(a,e,t){if("string"!=typeof a)return this.each(function(){var e=l(this),t=e.data("plugin_"+m);l.fn[m].destroy(e);t=l.extend({},r,a);e.data("plugin_"+m,t),i.push(e),l.fn[m].detectBrowser(e)});null!=l(this).data("plugin_"+m)&&l.fn[m].commandFishAnimation(this,a,e,t)},l.fn[m].detectBrowser=function(e){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);document.createElement("canvas").getContext&&(t.browserSupport=!0),t.browserSupport&&(t.isLoaded||(t.isLoaded=!0,l.fn[m].initPreload(e)))})},l.fn[m].initPreload=function(e){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);t.stageW=t.canvasW=e.attr("width"),t.stageH=t.canvasH=e.attr("height"),t.manifest=[],t.fishArray=[],t.manifest.push({src:t.fishImage,id:"fish",type:createjs.LoadQueue.IMAGE}),t.manifest.push({src:t.fishFinImage,id:"fishFin",type:createjs.LoadQueue.IMAGE}),t.loader=new createjs.LoadQueue(!1),t.loader.on("complete",function(){l.fn[m].handleLoaderComplete(e)}),t.loader.on("progress",function(){l.fn[m].handleLoaderProgress(e)}),t.loader.loadManifest(t.manifest)})},l.fn[m].handleLoaderComplete=function(e){return e.each(function(){var e=l(this);e.data("plugin_"+m);l.fn[m].initFishCanvas(e),l.fn[m].buildFishCanvas(e),l.fn[m].createFishes(e)})},l.fn[m].handleLoaderProgress=function(e){return e.each(function(){l(this).data("plugin_"+m)})},l.fn[m].initFishCanvas=function(e){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);t.stage=new createjs.Stage(e.attr("id")),t.interact&&(createjs.Touch.enable(t.stage),t.stage.enableMouseOver(20),t.stage.mouseMoveOutside=!0),s||(s=!0,createjs.Ticker.setFPS(60),createjs.Ticker.addEventListener("tick",l.fn[m].tick))})},l.fn[m].buildFishCanvas=function(e){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);t.itemCanvasContainer=new createjs.Container;var a={regX:t.fishImageRegX,regY:t.fishImageRegY,height:t.fishImageH,count:91,width:t.fishImageW},n={static:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,32],speed:t.spritesheetSpeed,next:"static"},turnsoft:{frames:[33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],speed:t.spritesheetSpeed,next:"static"},turnmedium:{frames:[51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68],speed:t.spritesheetSpeed,next:"static"},turnhard:{frames:[69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],speed:t.spritesheetSpeed,next:"static"}};t.fishData=new createjs.SpriteSheet({images:[t.loader.getResult("fish").src],frames:a,animations:n}),t.fishAnimate=new createjs.Sprite(t.fishData,"static"),t.fishAnimate.framerate=20;a={regX:t.fishFinImageRegX,regY:t.fishFinImageRegY,height:t.fishFinImageH,count:23,width:t.fishFinImageW},n={static:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],speed:t.spritesheetSpeed,next:"static"}};t.fishFinData=new createjs.SpriteSheet({images:[t.loader.getResult("fishFin").src],frames:a,animations:n}),t.fishFinLeftAnimate=new createjs.Sprite(t.fishFinData,"static"),t.fishFinLeftAnimate.framerate=20,t.fishFinRightAnimate=new createjs.Sprite(t.fishFinData,"static"),t.fishFinRightAnimate.framerate=20,t.fishFinRightAnimate.scaleX=-1,t.fishAnimate.x-=200,t.fishFinLeftAnimate.x-=200,t.fishFinRightAnimate.x-=200,(new createjs.Shape).graphics.beginFill("red").drawRect(0,0,t.fishImageW,t.fishImageH),t.itemCanvasContainer.addChild(t.fishAnimate,t.fishFinLeftAnimate,t.fishFinRightAnimate),t.stage.addChild(t.itemCanvasContainer),l.fn[m].resizeCanvas(e)})},l.fn[m].resizeCanvas=function(e){return e.each(function(){var e=l(this).data("plugin_"+m);null!=e.itemCanvasContainer&&(e.itemCanvasContainer.scaleX=e.itemCanvasContainer.scaleY=e.scalePercent)})},l.fn[m].resizeHolder=function(e,n,i){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);t.scalePercent=n/stageW,t.stageH*t.scalePercent>n&&(t.scalePercent=i/t.stageH);var a=document.getElementById(e.attr("id"));a.width=t.stageW*t.scalePercent,a.height=t.stageH*t.scalePercent,l.fn[m].resizeCanvas(e)})},l.fn[m].createFishes=function(e){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);for(f=0;f<t.number;f++)l.fn[m].createFish(e);l.fn[m].updateFishes(e,"colour")})},l.fn[m].createFish=function(e){return e.each(function(){var t=l(this),a=t.data("plugin_"+m),e=a.fishAnimate.clone(),n=a.fishFinLeftAnimate.clone(),i=a.fishFinRightAnimate.clone();e.scaleNum=.1*Math.floor(5*Math.random()),e.scale=e.scaleNum*a.scaleRange,e.type=1,e.swimspeed=a.swimspeed,e.turn=180*Math.random(),e.swimTimer=a.swimTimer+Math.random()*(a.swimTimer/2);var s=Math.floor(Math.random()*a.fishFinData.getNumFrames()-1);n.gotoAndPlay(Math.floor(Math.random()*s)),i.gotoAndPlay(Math.floor(Math.random()*s)),e.scaleX=e.scaleY=e.scale,n.scaleX=n.scaleY=e.scale,i.scaleY=e.scale,i.scaleX=-e.scale,e.id=a.fishArray.length-1,a.fishArray.push({fish:e,finLeft:n,finRight:i});a.fishArray.length;e.x=Math.random()*(a.canvasW/100*60)+a.canvasW/100*20,e.y=Math.random()*(a.canvasH/100*60)+a.canvasH/100*20,e.rotation=Math.floor(360*Math.random()-180),a.itemCanvasContainer.addChild(e,n,i),a.interact&&e.addEventListener("mouseover",function(e){l.fn[m].setFishRotate(t,e.target.id),e.target.swimspeed=4*a.swimspeed})})},l.fn[m].moveFish=function(e,s){return e.each(function(){var e=l(this),t=e.data("plugin_"+m),a=t.fishArray[s].fish,n=t.fishArray[s].finLeft,i=t.fishArray[s].finRight;a.updateCache(),n.updateCache(),i.updateCache(),a.swimTimer<=0?(a.swimTimer=t.swimTimer+Math.random()*(t.swimTimer/3),l.fn[m].setFishRotate(e,s)):a.swimTimer--,a.currentFrame<32&&(a.type=1),a.x+=a.swimspeed*Math.sin(a.rotation*Math.PI/180),a.y-=a.swimspeed*Math.cos(a.rotation*Math.PI/180),a.rotation+=(a.turn-a.rotation)/t.rounder,a.swimspeed*=t.downspeed})},l.fn[m].setFishRotate=function(e,r){return e.each(function(){var e=l(this).data("plugin_"+m),t=e.fishArray[r].fish;t.swimspeed=e.swimspeed;var a=e.canvasH/100*20,n=e.canvasH/100*80,i=e.canvasW/100*80,s=e.canvasW/100*20;t.y<a?t.rotation<0?(t.turn=-h(120),t.x<s&&(t.turn=-h(150))):(t.turn=h(120),t.x>i&&(t.turn=h(150))):t.y>n?t.rotation<0?(t.turn=-h(60),t.x>s&&(t.turn=-h(30))):(t.turn=h(60),t.x<i&&(t.turn=h(30))):t.x>i?t.rotation<90?(t.turn=-h(30),t.y<a&&(t.turn=-h(60))):(t.turn=-h(150),t.y<n&&(t.turn=-h(120))):t.x<s&&(-90<t.rotation?(t.turn=h(30),t.y<a&&(t.turn=h(60))):(t.turn=h(150),t.y>n&&(t.turn=h(120)))),t.turn+=Math.floor(Math.pow(Math.random()*e.turning-e.turning/2,3)),1==t.type&&(90<t.turn-t.rotation?(t.type=2,t.scaleX=t.scale,t.gotoAndPlay("turnhard")):t.turn-t.rotation<-90?(t.type=3,t.scaleX=-t.scale,t.gotoAndPlay("turnhard")):60<t.turn-t.rotation?(t.type=4,t.scaleX=t.scale,t.gotoAndPlay("turnmedium")):t.turn-t.rotation<-60?(t.type=5,t.scaleX=-t.scale,t.gotoAndPlay("turnmedium")):30<t.turn-t.rotation?(t.type=6,t.scaleX=t.scale,t.gotoAndPlay("turnsoft")):t.turn-t.rotation<-30&&(t.type=7,t.scaleX=-t.scale,t.gotoAndPlay("turnsoft")))})},l.fn[m].updateFishes=function(e,u){return e.each(function(){var e=l(this),a=e.data("plugin_"+m);if("colour"==u)for(t=0;t<a.fishArray.length;t++){var n=a.fishArray[t].fish,i=a.fishArray[t].finLeft,s=a.fishArray[t].finRight;n.uncache(),i.uncache(),s.uncache();var r=a.colour.replace("#",""),f=(3===r.length?r[0]+r[0]+r[1]+r[1]+r[2]+r[2]:r).match(/.{2}/g),h=parseInt(f[0],16),o=parseInt(f[1],16),c=parseInt(f[2],16);n.filters=i.filters=s.filters=[new createjs.ColorFilter(0,0,0,1,h,o,c,0)],n.cache(-a.fishImageRegX,-a.fishImageRegY,a.fishImageW,a.fishImageH),i.cache(-a.fishFinImageRegX,-a.fishFinImageRegY,a.fishFinImageW,a.fishFinImageH),s.cache(-a.fishFinImageRegX,-a.fishFinImageRegY,a.fishFinImageW,a.fishFinImageH)}else if("scaleRange"==u)for(t=0;t<a.fishArray.length;t++){n=a.fishArray[t].fish,i=a.fishArray[t].finLeft,s=a.fishArray[t].finRight;n.scale=n.scaleNum*a.scaleRange,n.scaleX=n.scaleY=n.scale,i.scaleX=i.scaleY=n.scale,s.scaleY=n.scale,s.scaleX=-n.scale}else if("number"==u)if(a.number>a.fishArray.length){for(t=a.fishArray.length;t<a.number;t++)l.fn[m].createFish(e);l.fn[m].updateFishes(e,"colour")}else for(t=a.number;t<a.fishArray.length;t++){n=a.fishArray[t].fish,i=a.fishArray[t].finLeft,s=a.fishArray[t].finRight;a.itemCanvasContainer.removeChild(n,i,s),a.fishArray.splice(t,1)}})},l.fn[m].tick=function(){for(n=0;n<i.length;n++){var e=i[n],t=e.data("plugin_"+m);if(0<t.fishArray.length){for(f=0;f<t.fishArray.length;f++)t.fishArray[f].finLeft.x=t.fishArray[f].finRight.x=t.fishArray[f].fish.x,t.fishArray[f].finLeft.y=t.fishArray[f].finRight.y=t.fishArray[f].fish.y,t.fishArray[f].finLeft.rotation=t.fishArray[f].finRight.rotation=t.fishArray[f].fish.rotation,l.fn[m].moveFish(e,f);t.stage.update()}}},l.fn[m].commandFishAnimation=function(e,a,n,i){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);switch(a){case"destroy":l.fn[m].destroy(e);break;default:null!=t[n]&&(t[n]=i,"number"==n?l.fn[m].updateFishes(e,"number"):"scaleRange"==n?l.fn[m].updateFishes(e,"scaleRange"):"colour"==n&&l.fn[m].updateFishes(e,"colour"))}})},l.fn[m].destroy=function(e){return e.each(function(){var e=l(this),t=e.data("plugin_"+m);if(null!=t&&t.isLoaded){t.isLoaded=!1,t.loader=null,t.stage.autoClear=!0,t.stage.removeAllChildren(),t.stage.update();var a=i.indexOf(e);i.splice(a,1),createjs.Ticker.removeEventListener("tick",t.stage),0==i.length&&(s=!1,createjs.Ticker.removeEventListener("tick",l.fn[m].tick))}})}}(jQuery);