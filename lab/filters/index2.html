<html><head><style type="text/css">form,input{width:73px;height:27px}form{position:relative;float:left;margin:0 10px 0 0}#up-button{position:absolute;right:0;top:0;cursor:pointer;opacity:0;outline:0}iframe{display:none}</style></head><body><div class="bt"><form id="uf"> <input type="file" name="file" id="up-button"> <input type="button" id="button" value="upload"></form> <input type="button" id="download" value="download"> <span><input type="radio" value="spread" id="spread" name="filter"><label for="spread">spread</label></span> <span><input type="radio" id="gray" name="filter"><label for="gray">gray</label></span> <span><input type="radio" id="comic" name="filter"><label for="comic">comic</label></span> <span><input type="radio" id="old" name="filter"><label for="old">old</label></span> <span><input type="radio" id="negatives" name="filter"><label for="negatives">negatives</label></span> <span><input type="radio" id="black" name="filter"><label for="black">black</label></span> <span><input type="radio" id="cameo" name="filter"><label for="cameo">cameo</label></span> <span><input type="radio" id="casting" name="filter"><label for="casting">casting</label></span> <span><input type="radio" id="frozen" name="filter"><label for="frozen">frozen</label></span> <span><input type="radio" id="sketch" name="filter"><label for="sketch">sketch</label></span> <span><input type="radio" id="gausian" name="filter"><label for="gausian">gausian</label></span> <span><input type="radio" id="opacity" name="filter"><label for="opacity">opacity</label></span> <span><input type="radio" id="bright" name="filter"><label for="bright">bright</label></span> <span><input type="radio" id="softblow" name="filter"><label for="softblow">softblow</label></span></div><br><canvas id="cv">fuck ie</canvas><canvas id="myCanvas">Gray Filter</canvas><script type="text/javascript" src="filter.js"></script><script>var _fixType=function(a){return"image/"+(a=a.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]},saveFile=function(a,t){var e=document.createElementNS("http://www.w3.org/1999/xhtml","a");e.href=a,e.download=t;var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(i)};document.getElementById("download").onclick=function(){var a="png",t=canvas.toDataURL(a);t=t.replace(_fixType(a),"image/octet-stream");var e="bloglaotou_"+(new Date).getTime()+"."+a;saveFile(t,e)};var cv=document.getElementById("cv"),c=cv.getContext("2d"),canvas=document.getElementById("myCanvas"),context=canvas.getContext("2d"),fileBtn=document.getElementById("up-button"),img=new Image;function init(){cv.width=img.width,cv.height=img.height,c.drawImage(img,0,0);var a="",t=document.getElementsByName("filter");for(i=0;i<t.length;i++)t[i].checked&&(a=t[i].id);switch(a){case"gray":setGray();break;case"spread":setSpread();break;case"comic":setComic();break;case"old":setOld();break;case"negatives":setNegatives();break;case"black":setBlack();break;case"cameo":setCameo();break;case"casting":setCasting();break;case"frozen":setFrozen();break;case"opacity":setOpacity();break;case"bright":setBright();break;case"softblow":setSoftblow();break;default:setGausian()}}function getImg(a){var t=new FileReader;t.readAsDataURL(fileBtn.files[0]),t.onload=function(){img.src=t.result}}function setSoftblow(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=softglow(t),a.putImageData(t,0,0)}function setBright(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=bright(t),a.putImageData(t,0,0)}function setOpacity(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=opacity(t),a.putImageData(t,0,0)}function setSketch(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=sketch(t),a.putImageData(t,0,0)}function setGausian(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height),e=gaussBlur(t.data,canvas.width,canvas.height);t.data=e,a.putImageData(t,0,0)}function setSpread(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=spread(t),a.putImageData(t,0,0)}function setGray(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=gray(t),a.putImageData(t,0,0)}function setOld(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=old(t),a.putImageData(t,0,0)}function setFrozen(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=frozen(t),a.putImageData(t,0,0)}function setCasting(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=casting(t),a.putImageData(t,0,0)}function setCameo(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=cameo(t),a.putImageData(t,0,0)}function setComic(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=comic(t),a.putImageData(t,0,0)}function setBlack(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=black(t),a.putImageData(t,0,0)}function setNegatives(){canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);t=negatives(t),a.putImageData(t,0,0)}fileBtn.onchange=getImg,window.onload=function(){img.src="image2.jpg",img.onload=init,canvas.width=img.width,canvas.height=img.height;var a=canvas.getContext("2d");a.drawImage(img,0,0);var t=a.getImageData(0,0,canvas.width,canvas.height);a.putImageData(t,0,0)},document.getElementById("softblow").onclick=setSoftblow,document.getElementById("bright").onclick=setBright,document.getElementById("opacity").onclick=setOpacity,document.getElementById("sketch").onclick=setSketch,document.getElementById("gausian").onclick=setGausian,document.getElementById("spread").onclick=setSpread,document.getElementById("gray").onclick=setGray,document.getElementById("old").onclick=setOld,document.getElementById("frozen").onclick=setFrozen,document.getElementById("casting").onclick=setCasting,document.getElementById("cameo").onclick=setCameo,document.getElementById("comic").onclick=setComic,document.getElementById("black").onclick=setBlack,document.getElementById("negatives").onclick=setNegatives</script></body></html>