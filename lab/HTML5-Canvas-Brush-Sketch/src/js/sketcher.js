function Sketcher(t,e){this.renderFunction=null==e||null==e?this.updateCanvasByLine:this.updateCanvasByBrush,this.brush=e,this.touchSupported=Modernizr.touch,this.canvasID=t,this.canvas=$("#"+t),this.context=this.canvas.get(0).getContext("2d"),this.context.strokeStyle="#000000",this.context.lineWidth=3,this.lastMousePoint={x:0,y:0},this.touchSupported?(this.mouseDownEvent="touchstart",this.mouseMoveEvent="touchmove",this.mouseUpEvent="touchend"):(this.mouseDownEvent="mousedown",this.mouseMoveEvent="mousemove",this.mouseUpEvent="mouseup"),this.canvas.bind(this.mouseDownEvent,this.onCanvasMouseDown())}Sketcher.prototype.onCanvasMouseDown=function(){var e=this;return function(t){e.mouseMoveHandler=e.onCanvasMouseMove(),e.mouseUpHandler=e.onCanvasMouseUp(),$(document).bind(e.mouseMoveEvent,e.mouseMoveHandler),$(document).bind(e.mouseUpEvent,e.mouseUpHandler),e.updateMousePosition(t),e.renderFunction(t)}},Sketcher.prototype.onCanvasMouseMove=function(){var e=this;return function(t){return e.renderFunction(t),t.preventDefault(),!1}},Sketcher.prototype.onCanvasMouseUp=function(t){var e=this;return function(t){$(document).unbind(e.mouseMoveEvent,e.mouseMoveHandler),$(document).unbind(e.mouseUpEvent,e.mouseUpHandler),e.mouseMoveHandler=null,e.mouseUpHandler=null}},Sketcher.prototype.updateMousePosition=function(t){var e;e=this.touchSupported?t.originalEvent.touches[0]:t;var o=this.canvas.offset();this.lastMousePoint.x=e.pageX-o.left,this.lastMousePoint.y=e.pageY-o.top},Sketcher.prototype.updateCanvasByLine=function(t){this.context.beginPath(),this.context.moveTo(this.lastMousePoint.x,this.lastMousePoint.y),this.updateMousePosition(t),this.context.lineTo(this.lastMousePoint.x,this.lastMousePoint.y),this.context.stroke()},Sketcher.prototype.updateCanvasByBrush=function(t){var e=this.brush.width/2,o=this.brush.height/2,n={x:this.lastMousePoint.x,y:this.lastMousePoint.y};this.updateMousePosition(t);for(var s,i,u={x:this.lastMousePoint.x,y:this.lastMousePoint.y},a=parseInt(Trig.distanceBetween2Points(n,u)),h=Trig.angleBetween2Points(n,u),r=0;r<=a||0==r;r++)s=n.x+Math.sin(h)*r-e,i=n.y+Math.cos(h)*r-o,this.context.drawImage(this.brush,s,i)},Sketcher.prototype.toString=function(){var t=this.canvas.get(0).toDataURL("image/png"),e=t.indexOf(",")+1;return t=t.substring(e)},Sketcher.prototype.toDataURL=function(){return this.canvas.get(0).toDataURL("image/png")},Sketcher.prototype.clear=function(){var t=this.canvas[0];this.context.clearRect(0,0,t.width,t.height)};