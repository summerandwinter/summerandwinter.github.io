define(function(a,r,o){var i=a("common"),t=!1,p=0,n=980,d=150,s=0,g=330;r.init=function(){$("body").on("active",function(){$("#program #programList").on("click","li a.itemName",function(){m(this)}),$("#program #programDetail a.closeBtn").on("click",function(){$("#program #programDetail").hide(),$("#program #programListBox").show()}),$("#program #programScoreBox a.closeBtn").on("click",function(){t=!1,$("#program #programScoreBox").hide(),$("#program #programListBox").show()}),$("#program #showProgramScore").on("click",function(){c()}),$("#program .pushProgram").on("click",function(){l()}),$("#program .endProgram").on("click",function(){f()})}),$("body").on("modulechange",function(a,r){"program"==r?($("#program").show(),e()):$("#program").hide()})};var e=function(){i.loading("数据正在准备中，请稍后"),$.extendGetJSON(i.httpURL+$("#GetProgram").val(),{},function(a){if(i.loaded(),$("#program #programList").empty(),a&&0<a.length){for(var r=0;r<a.length;r++)a[r].CanRated&&s++;var t="",e="";p=Math.max(0,(n-d*s)/2),$("#programScore").width(Math.max(n,s*d));var m=0;$.each(a,function(a,r){if(t+='<li><span class="order">'+(a+1)+"</span>",t+='<a href="javascript:void(0);" class="itemName" data-id="'+r.Id+'" data-mediapath="'+r.MediaPath+'" data-desc="'+r.Summary+'" data-isvideo="'+r.IsVideo+'">'+r.Name+"</a>",t+='<span class="programGourp">'+r.Actor+"</span></li>",r.CanRated)if(0==$('#program [data-programid="'+r.Id+'"]').size()){var o=m++*d+p;e+='<li data-programid="'+r.Id+'" data-useexpertscore="'+r.UseExpertScore+'" style="left:'+o+'px;"><span>'+r.Name+"</span>",r.UseExpertScore?e+='<div class="all"><div style="height:0;"></div><span style="bottom:10px;">0</span></div>':e+='<div class="all onediv"><div style="height:0;"></div><span style="bottom:10px;">0</span></div>',r.UseExpertScore&&(e+='<div class="pro"><div style="height:0;"></div><span style="bottom:10px;">0</span></div>'),e+='<div class="allScore" style="bottom:50px;">0</div></li>'}else r.UseExpertScore?0==$('#program [data-programid="'+r.Id+'"]>.pro').size()&&$('#program [data-programid="'+r.Id+'"]').append('<div class="pro"><div style="height:0;"></div><span style="bottom:10px;">0</span></div>'):$('#program [data-programid="'+r.Id+'"]>.pro').remove();else $('#program [data-programid="'+r.Id+'"]').remove()}),$("#program #programList").append(t),$("#program #programScore").append(e)}},function(){i.loaded(),i.showInfo("网络繁忙，请稍后重试")})},m=function(a){$("#program #programListBox").hide(),$("#program #programName").text($(a).text()),"true"==$(a).data("isvideo")?$("#program #programImg").html('<video src="'+$(a).data("mediapath")+'" style="width:400px;" controls></video>'):$("#program #programImg").html('<img src="'+$(a).data("mediapath")+'" alt="" />'),$("#program #programMsg").html($(a).data("desc")),$("#program #programDetail").show()},c=function(){$("#program #programListBox").hide(),$("#program #programScoreBox").show(),t=!0,h()},l=function(){i.loading("数据正在准备中，请稍后"),$.extendPost(i.httpURL+$("#PushProgram").val(),{},"text",function(a){if($("#programScoreBox .pushProgram").hide(),$("#programScoreBox .endProgram").show(),i.loaded(),""!=a)return i.showInfo(a),!1;i.showInfo("已推送",1),c()},function(){i.loaded(),i.showInfo("网络繁忙，请稍后重试")})},h=function(){t&&$.extendGetJSON(i.httpURL+$("#GetProgramStatistics").val(),{},function(a){if(0<a.length){for(var m=s=0,r=0;r<a.length;r++)s++,a[r].Common>m&&(m=a[r].Common),a[r].Expert>m&&(m=a[r].Expert);p=Math.max(0,(n-d*s)/2),$("#programScore").width(Math.max(n,s*d));var i=0;$(a).each(function(a,r){var o=$('#program [data-programid="'+r.ProgramId+'"]');if(0<o.size()){o.animate({left:parseInt(i++*d)+parseInt(p)});var t=0,e=0;0<m&&(t=r.Common/m,e=r.Expert/m),r.Common,r.Expert,$('#program [data-programid="'+r.ProgramId+'"]>.allScore').html(r.All),$('#program [data-programid="'+r.ProgramId+'"]>.all>span').html(r.Common).animate({bottom:t*g+10}),$('#program [data-programid="'+r.ProgramId+'"]>.all>div').animate({height:t*g}),o.data("useexpertscore")&&($('#program [data-programid="'+r.ProgramId+'"]>.pro>span').html(r.Expert).animate({bottom:e*g+10}),$('#program [data-programid="'+r.ProgramId+'"]>.pro>div').animate({height:e*g}))}})}setTimeout(function(){h()},2e3)},function(){setTimeout(function(){h()},5e3)})},f=function(){$.extendPost(i.httpURL+$("#CloseProgram").val(),{},"json",function(a){if(i.loaded(),1!=a.ResultType)return i.showInfo(a.Message),!1;i.showInfo("已关闭评分",1),$(".endProgram").hide(),$("#programScoreBox .pushProgram").show()},function(){i.loaded(),i.showInfo("网络繁忙，请稍后重试")})}});