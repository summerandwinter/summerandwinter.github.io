define(function(a,i,e){var l,p,n,r,o,h,t,s,d=a("common"),f=0,m=0,c=!1;i.init=function(){$("#pair .rightUser img,#pair .leftUser img").attr("src",$("#config>#FileWebHost").val()+"/ScreenTheme/default/images/default_pair.jpg"),$("body").on("active",function(){$("#pair .leftUser img").css("border","3px solid #06407c"),$("#pariNum a").click(function(){$(this).parent().prev(".select").find("a").attr({"data-pairnum":$(this).data("pairnum")}),$(this).parent().prev(".select").find("a").html($(this).html())}),$("#beginPair").click(function(){v()}),$("#stopPair").click(function(){b()}),$("#removePair").click(function(){$("#removePair").hasClass("gray")||($("#removePair").addClass("gray"),$("#submitPair").addClass("gray"),$(".leftUser div").remove(),$(".rightUser div").remove(),$("#pairUl li[data-pair!=1]").each(function(a,i){$(".leftUser ul").append('<li data-userid="'+$(this).data("onefansid")+'" data-headpath="'+$(this).data("onefansheadpath")+'"><img src="'+$(this).find("div").eq(0).find("img").attr("src")+'"><br><span>'+$(this).find("div").eq(0).find("font").html()+"</span></li>"),$(".rightUser ul").append('<li data-userid="'+$(this).data("anotherfansid")+'" data-headpath="'+$(this).data("anotherfansheadpath")+'"><img src="'+$(this).find("div").eq(1).find("img").attr("src")+'"><br><span>'+$(this).find("div").eq(1).find("font").html()+"</span></li>")}),$("#pairUl").find("li").remove(),$("#pairUl").mCustomScrollbar("update"),$("#pairNumber").html(0))}),$("#submitPair").click(function(){w()}),$("#pairUl").on("click","a",function(){y($(this))})}),$("body").on("modulechange",function(a,i){"pair"==i?($("#pair").show(),u(),g()):$("#pair").hide()})};var g=function(){$("#pairUl").html(""),$.extendGetJSON(d.httpURL+$("#GetPairs").val(),{},function(a){0<a.length&&($(a).each(function(a,i){$("#pairUl").prepend('<li data-pair="1"><span></span><div><img onerror="imgError(this);" src="'+i.OneHead+'"><font>'+i.OneNickName+'</font></div><div><img onerror="imgError(this);" src="'+i.AnotherHead+'"><font>'+i.AnotherNickName+'</font></div><i class="hasSubmit">已提交</i></li>')}),$("#pairUl li").each(function(a,i){$(this).find("span").html($("#pairUl li").length-$(this).index())}))},function(){d.showInfo("加载失败,请重试!"),d.loaded()})},u=function(){d.loading("数据加载中,请稍后");var t=$(".leftUser ul"),n=$(".rightUser ul");t.html("").hide(),n.html("").hide(),$.extendGetJSON(d.httpURL+$("#GetPairFans").val(),{},function(a){0<a.length&&($(a).each(function(a,i){var e='<li data-userid="'+i.Id+'" data-headpath="'+i.HeadPath+'"><img onerror="imgError(this);" src="'+i.Head+'"><br><span>'+i.NickName+"</span></li>";a%2==0?t.append(e):n.append(e)}),$("#defaultFemale").html("共"+t.find("li").length+"位"),$("#defaultMale").html("共"+n.find("li").length+"位"),0<t.find("li").length&&t.show().next().remove(),0<n.find("li").length&&n.show().next().remove()),d.loaded()},function(){t.html(""),n.html(""),d.showInfo("加载失败,请重试!"),d.loaded()})},v=function(){return n=$(".leftUser ul"),r=$(".rightUser ul"),t=$("#pair_count").find("a").attr("data-pairnum"),s=(c=1<t)?t:1,n.find("li").length<1||r.find("li").length<1?(d.showInfo("抱歉,人数不够"),!1):n.find("li").length<t||r.find("li").length<t?(d.showInfo("抱歉,人数不够!"),!1):void U()},U=function(){$(".leftUser div").remove(),$(".rightUser div").remove(),n.css({width:200*$(".leftUser").find("li").length}),r.css({width:200*$(".rightUser").find("li").length}),n.show(),r.show(),c&&($("#pairIng").css("display","block"),$("#pairIng span").html(s),setTimeout(function(){b()},1e3*Math.floor(5*Math.random()+1))),l=setInterval(function(){n.css({left:-f}),(f+=200)>=200*$(".leftUser li").length&&(f=0)},50),p=setInterval(function(){r.css({left:-m}),(m+=200)>=200*$(".rightUser li").length&&(m=0)},50),$("#beginPair").hide(),$("#stopPair").show()},b=function(){$("#beginPair").show(),$("#stopPair").hide(),$("#removePair").removeClass("gray"),$("#submitPair").removeClass("gray"),clearInterval(l),clearInterval(p),o=parseInt($(".leftUser ul").css("left"))/200*-1;var a=$(".leftUser li").eq(o).data("userid"),i=$(".leftUser li").eq(o).find("img").attr("src"),e=$(".leftUser li").eq(o).data("headpath"),t=$(".leftUser li").eq(o).find("span").html();h=parseInt($(".rightUser ul").css("left"))/200*-1;var n=$(".rightUser li").eq(h).data("userid"),r=$(".rightUser li").eq(h).find("img").attr("src"),s=$(".rightUser li").eq(h).data("headpath"),d=$(".rightUser li").eq(h).find("span").html();$("#pairUl").prepend('<li data-onefansid="'+a+'" data-onefansheadpath="'+e+'" data-onefansnickname="'+t+'" data-anotherfansid="'+n+'" data-anotherfansheadpath="'+s+'" data-anotherfansnickname="'+d+'" ><span></span><a>x</a><div><img onerror="imgError(this);" src="'+i+'"><font>'+t+'</font></div><div><img onerror="imgError(this);" src="'+r+'"><font>'+d+"</font></div></li>"),$("#pairNumber").html($("#pairUl li").length),$("#pairUl li").each(function(a,i){$(this).find("span").html($("#pairUl li").length-$(this).index())}),P(i,t,r,d)},y=function(a){var i=a;$(".leftUser div").remove(),$(".rightUser div").remove(),i.parent().attr("data-pair")||($(".leftUser ul").append('<li data-userid="'+i.parent().data("onefansid")+'" data-headpath="'+i.parent().data("onefansheadpath")+'"><img src="'+i.parent().find("div").eq(0).find("img").attr("src")+'"><br><span>'+i.parent().find("div").eq(0).find("font").html()+"</span></li>"),$(".rightUser ul").append('<li data-userid="'+i.parent().data("anotherfansid")+'" data-headpath="'+i.parent().data("anotherfansheadpath")+'"><img src="'+i.parent().find("div").eq(1).find("img").attr("src")+'"><br><span>'+i.parent().find("div").eq(1).find("font").html()+"</span></li>"),i.parent().remove()),$("#pairUl li").each(function(a,i){$(this).find("span").html($("#pairUl li").length-$(this).index())}),0==$("#pairUl li").length&&($("#removePair").addClass("gray"),$("#submitPair").addClass("gray"))};var w=function(a){var i=$("#pairUl li[data-pair!=1]").size();if(!$("#submitPair").hasClass("gray")&&0<i){d.loading("正在提交，请稍后");var e=$("<form/>");$("#pairUl li[data-pair!=1]").each(function(a,i){e.append('<input name="['+a+'].OneFansId" type="hidden" value="'+$(i).data("onefansid")+'" />'),e.append('<input name="['+a+'].OneNickName" type="hidden" value="'+$(i).data("onefansnickname")+'" />'),e.append('<input name="['+a+'].OneHead" type="hidden" value="'+$(i).data("onefansheadpath")+'" />'),e.append('<input name="['+a+'].AnotherFansId" type="hidden" value="'+$(i).data("anotherfansid")+'" />'),e.append('<input name="['+a+'].AnotherNickName" type="hidden" value="'+$(i).data("anotherfansnickname")+'" />'),e.append('<input name="['+a+'].AnotherHead" type="hidden" value="'+$(i).data("anotherfansheadpath")+'" />')}),e.append('<input name="isPeng" type="hidden" value="false" />'),$.extendPost(d.httpURL+$("#SubmitPairs").val(),e.serializeArray(),"json",function(a){d.loaded(),1==a.ResultType?(d.showInfo("提交成功",1),$("#removePair").addClass("gray"),$("#submitPair").addClass("gray"),$("#pairUl li[data-pair!=1]").attr("data-pair",1)):d.showInfo(a.Message)})}},P=function(a,i,e,t){$("body").append('<div class="blackbg"></div><div class="pairLeft"><img src='+a+'></div><div class="pairRight"><img src='+e+'></div><div class="pairAnimateBg1"></div>'),$(".pairAnimateBg1").animate({"margin-left":"-500px","margin-top":"-250px",opacity:"1"},function(){$(".pairgif").animate({opacity:"1"}),$(".pairLeft").show().animate({"margin-left":"-700px"},"slow",function(){$(".pairLeft").css("z-index","99999").animate({"margin-left":"-185px"},"fast")}),$(".pairRight").show().animate({"margin-left":"600px"},"slow",function(){$(".pairRight").css("z-index","99999").animate({"margin-left":"45px"},"fast")})}),$("#flash").css("opacity","1").show(),setTimeout(function(){n.find("li").eq(o).remove(),r.find("li").eq(h).remove(),0==n.find("li").size()&&n.parent().append('<div><img src="'+$("#config>#FileWebHost").val()+'/ScreenTheme/default/images/default_pair.jpg"><br><span id="defaultFemale">没人了</span></div>'),0==r.find("li").size()&&r.parent().append('<div><img src="'+$("#config>#FileWebHost").val()+'/ScreenTheme/default/images/default_pair.jpg"><br><span id="defaultMale">没人了</span></div>'),1<s?(s--,U()):($("#pairIng").css("display","none"),n.css({width:200*$(".leftUser").find("li").length,left:Math.min(200-f,0)}),r.css({width:200*$(".rightUser").find("li").length,left:Math.min(200-m,0)})),$(".pairLeft").animate({"margin-left":"-1080px",opacity:"0"},"fast",function(){$(".pairLeft").remove()}),$(".pairRight").animate({"margin-left":"1080px",opacity:"0"},"fast",function(){$(".pairRight").remove()}),$(".pairgif").animate({opacity:"0"},function(){$(".pairgif").remove()}),$(".pairAnimateBg1").animate({opacity:"0"},function(){$(".pairAnimateBg1").remove()}),$(".blackbg").animate({opacity:"0"},"slow",function(){$(".blackbg").remove()}),$("#flash").animate({opacity:"0"},"slow",function(){$("#flash").hide()})},3e3)}});