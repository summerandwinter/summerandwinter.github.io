define(function(t,i,h){var e,a;i.httpURL="http://activity.86wa.com";var n,o=[],r=!1;i.hide=function(){$("#canvas").remove(),r=!1},i.show=function(){r=!0,$("body").append('<canvas id="canvas"></canvas>'),$("#canvas").attr({width:$(window).width(),height:$(window).height()}),e=document.getElementById("canvas"),a=e.getContext("2d"),o=[],s()};var s=function(){n=new Date,r&&c()},c=function(){a.save(),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,e.width,e.height),a.restore();var t=new Date;if(300<t-n){var i=m(e.width/5,4*e.width/5),h=m(50,200),s=new f(m(e.width/3,2*e.width/3),2,"#FFF",{x:i,y:h});o.push(s),n=t}o.foreach(function(t){var i=this;this.dead?this.booms.foreach(function(t){this.dead?t===i.booms.length-1&&(o[o.indexOf(i)]=null):this.moveTo(t)}):(this._move(),this._drawLight())}),r&&d(c)};Array.prototype.foreach=function(t){for(var i=0;i<this.length;i++)null!==this[i]&&t.apply(this[i],[i])};var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1)},f=function(t,i,h,s,a){this.booms=[],this.x=t,this.y=e.height+i,this.r=i,this.c=h,this.shape=a||!1,this.boomArea=s,this.theta=0,this.dead=!1,this.ba=parseInt(m(80,200))};f.prototype={_paint:function(){a.save(),a.beginPath(),a.arc(this.x,this.y,this.r,0,2*Math.PI),a.fillStyle=this.c,a.fill(),a.restore()},_move:function(){var t=this.boomArea.x-this.x,i=this.boomArea.y-this.y;this.x=this.x+.09*t,this.y=this.y+.09*i,Math.abs(t)<=this.ba&&Math.abs(i)<=this.ba?(this.shape?this._shapBoom():this._boom(),this.dead=!0):this._paint()},_drawLight:function(){a.save(),a.fillStyle="rgba(255,228,150,0.3)",a.beginPath(),a.arc(this.x,this.y,this.r+3*Math.random()+1,0,2*Math.PI),a.fill(),a.restore()},_boom:function(){var t,i=m(30,200),h=5<=m(0,10)?1:2;1===h&&(t={a:parseInt(m(128,255)),b:parseInt(m(128,255)),c:parseInt(m(128,255))});for(var s=parseInt(m(300,800)),a=0;a<i;a++){2===h&&(t={a:parseInt(m(128,255)),b:parseInt(m(128,255)),c:parseInt(m(128,255))});var e=m(-Math.PI,Math.PI),n=m(0,s)*Math.cos(e)+this.x,o=m(0,s)*Math.sin(e)+this.y,r=m(0,5),c=new l(this.x,this.y,r,t,n,o);this.booms.push(c)}}};var m=function(t,i){return Math.random()*(i-t)+t},l=function(t,i,h,s,a,e){this.tx=a,this.ty=e,this.x=t,this.y=i,this.dead=!1,this.centerX=t,this.centerY=i,this.radius=h,this.color=s};l.prototype={paint:function(){a.save(),a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI),a.fillStyle="rgba("+this.color.a+","+this.color.b+","+this.color.c+",1)",a.fill(),a.restore()},moveTo:function(t){this.ty=this.ty+.3;var i=this.tx-this.x,h=this.ty-this.y;this.x=Math.abs(i)<.1?this.tx:this.x+.1*i,this.y=Math.abs(h)<.1?this.ty:this.y+.1*h,0===i&&Math.abs(h)<=80&&(this.dead=!0),this.paint()}}});