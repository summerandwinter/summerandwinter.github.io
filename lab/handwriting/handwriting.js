var canvasWidth=Math.min(800,$(window).width()-20),canvasHeight=canvasWidth,strokeColor="black",isMouseDown=!1,lastLoc={x:0,y:0},lastTimestamp=0,lastLineWidth=-1,canvas=document.getElementById("canvas"),context=canvas.getContext("2d");function beginStroke(t){isMouseDown=!0,lastLoc=windowToCanvas(t.x,t.y),lastTimestamp=(new Date).getTime()}function endStroke(){isMouseDown=!1}function moveStroke(t){var e=windowToCanvas(t.x,t.y),n=(new Date).getTime(),o=calcDistance(e,lastLoc),a=calcLineWidth(n-lastTimestamp,o);context.beginPath(),context.moveTo(lastLoc.x,lastLoc.y),context.lineTo(e.x,e.y),context.strokeStyle=strokeColor,context.lineWidth=a,context.lineCap="round",context.lineJoin="round",context.stroke(),lastLoc=e,lastTimestamp=n,lastLineWidth=a}canvas.width=canvasWidth,canvas.height=canvasHeight,$("#controller").css("width",canvasWidth+"px"),drawGrid(),$("#clear_btn").click(function(t){context.clearRect(0,0,canvasWidth,canvasHeight),drawGrid()}),$(".color_btn").click(function(t){$(".color_btn").removeClass("color_btn_selected"),$(this).addClass("color_btn_selected"),strokeColor=$(this).css("background-color")}),canvas.onmousedown=function(t){t.preventDefault(),beginStroke({x:t.clientX,y:t.clientY})},canvas.onmouseup=function(t){t.preventDefault(),endStroke()},canvas.onmouseout=function(t){t.preventDefault(),endStroke()},canvas.onmousemove=function(t){t.preventDefault(),isMouseDown&&moveStroke({x:t.clientX,y:t.clientY})},canvas.addEventListener("touchstart",function(t){t.preventDefault(),touch=t.touches[0],beginStroke({x:touch.pageX,y:touch.pageY})}),canvas.addEventListener("touchmove",function(t){t.preventDefault(),isMouseDown&&(touch=t.touches[0],moveStroke({x:touch.pageX,y:touch.pageY}))}),canvas.addEventListener("touchend",function(t){t.preventDefault(),endStroke()});var maxLineWidth=30,minLineWidth=1,maxStrokeV=10,minStrokeV=.1;function calcLineWidth(t,e){var n,o=e/t;return n=o<=minStrokeV?maxLineWidth:maxStrokeV<=o?minLineWidth:maxLineWidth-(o-minStrokeV)/(maxStrokeV-minStrokeV)*(maxLineWidth-minLineWidth),-1==lastLineWidth?n:1*n/3+2*lastLineWidth/3}function calcDistance(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function windowToCanvas(t,e){var n=canvas.getBoundingClientRect();return{x:Math.round(t-n.left),y:Math.round(e-n.top)}}function drawGrid(){context.save(),context.strokeStyle="rgb(230,11,9)",context.beginPath(),context.moveTo(3,3),context.lineTo(canvasWidth-3,3),context.lineTo(canvasWidth-3,canvasHeight-3),context.lineTo(3,canvasHeight-3),context.closePath(),context.lineWidth=6,context.stroke(),context.beginPath(),context.moveTo(0,0),context.lineTo(canvasWidth,canvasHeight),context.moveTo(canvasWidth,0),context.lineTo(0,canvasHeight),context.moveTo(canvasWidth/2,0),context.lineTo(canvasWidth/2,canvasHeight),context.moveTo(0,canvasHeight/2),context.lineTo(canvasWidth,canvasHeight/2),context.lineWidth=1,context.stroke(),context.restore()}