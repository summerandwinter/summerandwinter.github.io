function aboutWindow(){var t=[];Ext.getBody().select("div.tab").each(function(e){t.push({title:e.select("h2").first().dom.innerHTML,html:e.select("div").first().dom.innerHTML.replace("{gabor}",'<a href="mailto:turi.gabor@gmail.com">Gabor Turi</a>')})}),new Ext.Window({title:document.title,width:640,height:400,modal:!0,layout:"fit",items:new Ext.TabPanel({defaults:{autoScroll:!0,bodyStyle:"padding: 5px;"},activeTab:0,items:t})}).show()}"undefined"==typeof Range||Range.prototype.createContextualFragment||(Range.prototype.createContextualFragment=function(e){var t=document.createDocumentFragment(),n=document.createElement("div");return t.appendChild(n),n.outerHTML=e,t}),Ext.override(Ext.tree.TreeNode,{removeAllChildren:function(){for(;this.hasChildNodes();)this.removeChild(this.firstChild);return this},setIcon:function(e){this.getUI().setIcon(e)},setIconCls:function(e){this.getUI().setIconCls(e)}}),Ext.override(Ext.tree.TreeNodeUI,{setIconCls:function(e){this.iconNode&&Ext.fly(this.iconNode).replaceClass(this.node.attributes.iconCls,e),this.node.attributes.iconCls=e},setIcon:function(e){this.iconNode&&(this.iconNode.src=e||this.emptyIcon,Ext.fly(this.iconNode)[e?"addClass":"removeClass"]("x-tree-node-inline-icon")),this.node.attributes.icon=e}}),Ext.override(Ext.Panel,{hideBbar:function(){this.bbar&&(this.bbar.setVisibilityMode(Ext.Element.DISPLAY),this.bbar.hide(),this.getBottomToolbar().hide(),this.syncSize(),this.ownerCt&&this.ownerCt.doLayout())},showBbar:function(){this.bbar&&(this.bbar.setVisibilityMode(Ext.Element.DISPLAY),this.bbar.show(),this.getBottomToolbar().show(),this.syncSize(),this.ownerCt&&this.ownerCt.doLayout())}}),Ext.ux.iconCls=function(){var n="styleSheetIconCls",o={};return Ext.util.CSS.createStyleSheet("/* Ext.ux.iconCls */",n),{get:function(e){if(!e)return null;if(void 0===o[e]){o[e]="icon_"+Ext.id();var t="\n."+o[e]+" { background-image: url("+e+") !important; }";Ext.isIE?document.styleSheets[n].cssText+=t:Ext.get(n).dom.sheet.insertRule(t,0)}return o[e]}}}(),Ext.getBody().on("contextmenu",function(e){e.preventDefault()}),String.space=function(e){var t,n=[];for(t=0;t<e;t++)n.push(" ");return n.join("")},Ext.onReady(function(){var e,t=(e=null,{init:function(){e=new Ext.Window({title:document.title,width:400,minWidth:400,height:100,minHeight:100,maxHeight:100,layout:"form",closeAction:"hide",bodyStyle:"padding: 0",border:!1,labelWidth:25,items:{xtype:"textfield",fieldLabel:"Url",value:"http://",width:350},buttonAlign:"center",buttons:[{text:"Load JSON data!",handler:function(){b.loadJson(e.items.get(0).getValue()),e.hide()}}],listeners:{resize:function(e,t,n){e.items.get(0).setWidth(t-50)}}})},show:function(){e||this.init(),e.show()}});Ext.BLANK_IMAGE_URL="extjs/images/default/s.gif",Ext.QuickTips.init();var n=new Ext.KeyMap(document,[{key:Ext.EventObject.F,ctrl:!0,stopEvent:!0,fn:function(){b.ctrlF()}},{key:Ext.EventObject.H,ctrl:!0,stopEvent:!0,fn:function(){b.hideToolbar()}}]);n.disable();var s,o,i,r,a,l,c,d,u,h,x,f={xtype:"propertygrid",id:"grid",region:"east",width:300,split:!0,listeners:{beforeedit:function(){return!1}},selModel:new Ext.grid.RowSelectionModel,onRender:Ext.grid.PropertyGrid.superclass.onRender},g={id:"viewerPanel",layout:"border",title:"Viewer",items:[{id:"tree",xtype:"treepanel",region:"center",loader:new Ext.tree.TreeLoader,lines:!0,root:new Ext.tree.TreeNode({text:"JSON"}),autoScroll:!0,trackMouseOver:!1,listeners:{render:function(e){e.getSelectionModel().on("selectionchange",function(e,t){b.gridbuild(t)})},contextmenu:function(e,t){new Ext.menu.Menu({items:[{text:"Expand",handler:function(){e.expand()}},{text:"Expand all",handler:function(){e.expand(!0)}},"-",{text:"Collapse",handler:function(){e.collapse()}},{text:"Collapse all",handler:function(){e.collapse(!0)}}]}).showAt(t.getXY())}},bbar:["Search:",new Ext.form.TextField({xtype:"textfield",id:"searchTextField"}),new Ext.Button({text:"GO!",handler:function(){b.searchStart()}}),new Ext.form.Label({id:"searchResultLabel",style:"padding-left:10px;font-weight:bold"}),{iconCls:Ext.ux.iconCls.get("arrow_down.png"),text:"Next",handler:function(){b.searchNext()}},{iconCls:Ext.ux.iconCls.get("arrow_up.png"),text:"Previous",handler:function(){b.searchPrevious()}}]},f]},p={id:"textPanel",layout:"fit",title:"Text",tbar:[{text:"Paste",handler:function(){b.pasteText()}},{text:"Copy",handler:function(){b.copyText()}},"-",{text:"Format",handler:function(){b.format()}},{text:"Remove white space",handler:function(){b.removeWhiteSpace()}},"-",{text:"Clear",handler:function(){b.clearText()}},"-",{text:"Load JSON data",handler:function(){t.show()}},"->",{text:"About",handler:aboutWindow}],items:{id:"edit",xtype:"textarea",style:"font-family:monospace",emptyText:"Copy here the JSON variable!"}},b=(new Ext.Viewport({layout:"fit",items:[{xtype:"tabpanel",items:[g,p],activeTab:"textPanel",listeners:{beforetabchange:function(e,t){if("viewerPanel"===t.id)return b.check()},tabchange:function(e,t){"viewerPanel"===t.id?n.enable():n.disable()}}}]}),s=Ext.getCmp("edit"),o=Ext.getCmp("tree"),i=o.getRootNode(),r=Ext.getCmp("grid"),a=Ext.getCmp("searchTextField"),l=Ext.getCmp("searchResultLabel"),c={},x=h=u=d=null,{check:function(){var e=s.getValue().replace(/\n/g," ").replace(/\r/g," ");try{c=Ext.util.JSON.decode(e)}catch(e){return Ext.MessageBox.show({title:"JSON error",msg:"Invalid JSON variable",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK,closable:!1}),!1}d!==e&&(d=e,this.treebuild())},treebuild:function(){i.removeAllChildren(),i.appendChild(this.json2leaf(c)),i.setIcon(Ext.isArray(c)?"array.gif":"object.gif"),this.gridbuild(i),i.expand.defer(50,i,[!1,!1])},gridbuild:function(e){e.isLeaf()&&(e=e.parentNode),e.childNodes.length||(e.expand(!1,!1),e.collapse(!1,!1));for(var t={},n=0;n<e.childNodes.length;n++){var o=e.childNodes[n].text.indexOf(":");-1===o?t[e.childNodes[n].text]="...":t[e.childNodes[n].text.substring(0,o)]=e.childNodes[n].text.substring(o+1)}r.setSource(t)},json2leaf:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&(null===e[n]?t.push({text:n+" : null",leaf:!0,icon:"red.gif"}):"string"==typeof e[n]?t.push({text:n+' : "'+e[n]+'"',leaf:!0,icon:"blue.gif"}):"number"==typeof e[n]?t.push({text:n+" : "+e[n],leaf:!0,icon:"green.gif"}):"boolean"==typeof e[n]?t.push({text:n+" : "+(e[n]?"true":"false"),leaf:!0,icon:"yellow.gif"}):"object"==typeof e[n]?t.push({text:n,children:this.json2leaf(e[n]),icon:Ext.isArray(e[n])?"array.gif":"object.gif"}):"function"==typeof e[n]&&t.push({text:n+" : function",leaf:!0,icon:"red.gif"}));return t},copyText:function(){s.getValue()&&Ext.ux.Clipboard.set(s.getValue())},pasteText:function(){s.setValue(Ext.ux.Clipboard.get())},clearText:function(){s.reset(),s.focus(null,!0)},searchStart:function(){u||(u=new Ext.util.DelayedTask(this.searchFn,this)),u.delay(150)},searchFn:function(){h=[],a.getValue()&&(this.searchInNode(i,a.getValue()),h.length?(l.setText(""),x=0,this.selectNode(h[x]),a.focus()):l.setText("Phrase not found!"))},searchInNode:function(e,t){-1!==e.text.toUpperCase().indexOf(t.toUpperCase())&&h.push(e);var n=e.isExpanded();e.expand(!1,!1);for(var o=0;o<e.childNodes.length;o++)this.searchInNode(e.childNodes[o],t);n||e.collapse(!1,!1)},selectNode:function(e){for(e.select(),o.fireEvent("click",e);e!==i;)(e=e.parentNode).expand(!1,!1)},searchNext:function(){h&&h.length&&(x=(x+1)%h.length,this.selectNode(h[x]))},searchPrevious:function(){h&&h.length&&(x=(x-1+h.length)%h.length,this.selectNode(h[x]))},ctrlF:function(){o.getBottomToolbar().isVisible()||o.showBbar(),a.focus(!0)},hideToolbar:function(){o.hideBbar()},format:function(){for(var e=s.getValue().replace(/\n/g," ").replace(/\r/g," "),t=[],n=0,o=!1,i=0,r=e.length;i<r;i++){var a=e.charAt(i);o&&a===o?"\\"!==e.charAt(i-1)&&(o=!1):o||'"'!==a&&"'"!==a?o||" "!==a&&"\t"!==a?o||":"!==a?o||","!==a?o||"["!==a&&"{"!==a?o||"]"!==a&&"}"!==a||(n--,a="\n"+String.space(2*n)+a):(n++,a+="\n"+String.space(2*n)):a+="\n"+String.space(2*n):a+=" ":a="":o=a,t.push(a)}s.setValue(t.join(""))},removeWhiteSpace:function(){for(var e=s.getValue().replace(/\n/g," ").replace(/\r/g," "),t=[],n=!1,o=0,i=e.length;o<i;o++){var r=e.charAt(o);n&&r===n?"\\"!==e.charAt(o-1)&&(n=!1):n||'"'!==r&&"'"!==r?n||" "!==r&&"\t"!==r||(r=""):n=r,t.push(r)}s.setValue(t.join(""))},loadJson:function(e){document.location.hash!=="#"+e&&(document.location.hash=e),Ext.getBody().mask("Loading url: "+e,"x-mask-loading"),Ext.Ajax.request({url:"readjson.php",params:{url:e},success:function(e){Ext.getCmp("edit").setValue(e.responseText),b.format(),Ext.getBody().unmask()},failure:function(e){Ext.Msg.alert("Error",e.responseText),Ext.getBody().unmask()}})}});document.location.hash&&document.location.hash.length&&b.loadJson(document.location.hash.substring(1))});