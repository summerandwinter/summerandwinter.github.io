<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>用Canvas实现图片滤镜效果详解之灰度效果 | Winter`s Notes</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="canonical" href="https://summerandwinter.github.io/image-filters-by-canvas-gray.html"><meta name="description" content="利用用Canvas技术和计算机图形原理实现图片灰度滤镜效果"><meta name="keywords" content="HTML5,Canvas,图像滤镜,滤镜,灰度滤镜"><meta property="og:type" content="article"><meta property="og:title" content="用Canvas实现图片滤镜效果详解之灰度效果"><meta property="og:url" content="https://summerandwinter.github.io/image-filters-by-canvas-gray.html"><meta property="og:site_name" content="Winter`s Notes"><meta property="og:description" content="利用用Canvas技术和计算机图形原理实现图片灰度滤镜效果"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/original.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/gray.jpg"><meta property="og:updated_time" content="2019-11-28T08:58:49.415Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="用Canvas实现图片滤镜效果详解之灰度效果"><meta name="twitter:description" content="利用用Canvas技术和计算机图形原理实现图片灰度滤镜效果"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/original.jpg"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/gitment.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/css/article.css"></head></html><body><div id="container"><div id="wrap"><header id="header" class="header"><nav id="main-nav" class="main-nav"> <a class="main-nav-link" href="/">主页</a> <a class="main-nav-link" href="/archives">归档</a> <a class="main-nav-link" href="/category">分类</a> <a class="main-nav-link" href="/tag">标签</a></nav><nav id="sub-nav"></nav></header><div class="outer"><section id="main"><div class="article-container"><article id="post-image-filters-by-canvas-gray" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> 用Canvas实现图片滤镜效果详解之灰度效果</h1></header><div class="article-entry typo" itemprop="articleBody"><p>前面展示了一些canvas实现图片滤镜效果的展示，并且给出了相应的算法，下面来介绍一下具体的实现方法。</p><p>前面介绍的特效中灰度效果最简单，就从这里开始介绍吧。</p><h3 id="1-获取图像数据"><a href="#1-获取图像数据" class="headerlink" title="1.获取图像数据"></a>1.获取图像数据</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">img.src = ‘original.jpg’;</span><br><span class="line">canvas.width = img.width;</span><br><span class="line">canvas.height = img.height;</span><br><span class="line"><span class="keyword">var</span> context = canvas.getContext(“<span class="number">2</span>d”);</span><br><span class="line">context.drawImage(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> canvasData = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br></pre></td></tr></table></figure><h3 id="2-通过灰度算法处理图像数据"><a href="#2-通过灰度算法处理图像数据" class="headerlink" title="2.通过灰度算法处理图像数据"></a>2.通过灰度算法处理图像数据</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.灰度效果</span></span><br><span class="line"><span class="comment">//计算公式 .299 r + .587 g + .114 * b;</span></span><br><span class="line"><span class="comment">// calculate gray scale value</span></span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">var</span> x = <span class="number">0</span>; x &lt; canvasData.width; x++) &#123;</span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">var</span> y = <span class="number">0</span>; y &lt; canvasData.height; y++) &#123;</span><br><span class="line"><span class="comment">// Index of the pixel in the array</span></span><br><span class="line"><span class="keyword">var</span> idx = (x + y canvasData.width) <span class="number">4</span>;</span><br><span class="line"><span class="keyword">var</span> r = canvasData.data[idx + <span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> g = canvasData.data[idx + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">var</span> b = canvasData.data[idx + <span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> gray = <span class="number">.299</span> r + <span class="number">.587</span> g + <span class="number">.114</span> * b;</span><br><span class="line"><span class="comment">// assign gray scale value</span></span><br><span class="line">canvasData.data[idx + <span class="number">0</span>] = gray; <span class="comment">// Red channel</span></span><br><span class="line">canvasData.data[idx + <span class="number">1</span>] = gray; <span class="comment">// Green channel</span></span><br><span class="line">canvasData.data[idx + <span class="number">2</span>] = gray; <span class="comment">// Blue channel</span></span><br><span class="line">canvasData.data[idx + <span class="number">3</span>] = <span class="number">255</span>; <span class="comment">// Alpha channel</span></span><br><span class="line"><span class="comment">// 加上黑色的边框</span></span><br><span class="line"><span class="keyword">if</span>(x &lt; <span class="number">8</span> || y &lt; <span class="number">8</span> || x &gt; (canvasData.width - <span class="number">8</span>) || y &gt; (canvasData.height - <span class="number">8</span>))</span><br><span class="line">&#123;</span><br><span class="line">canvasData.data[idx + <span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">canvasData.data[idx + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">canvasData.data[idx + <span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-把新的图像数据写入canvas"><a href="#3-把新的图像数据写入canvas" class="headerlink" title="3.把新的图像数据写入canvas"></a>3.把新的图像数据写入canvas</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">context.putImageData(canvasData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="4-效果预览"><a href="#4-效果预览" class="headerlink" title="4.效果预览"></a>4.效果预览</h3><p><strong>原图</strong></p><p><img src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/original.jpg" alt="原图"></p><p><strong>效果图</strong></p><p><img src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/assets/images/filter/gray.jpg" alt="效果图"></p><p>查看<strong><a href="/lab/filters/gray.html">示例</a></strong></p><div class="end-of-file">END</div></div><footer class="article-footer"><ul class="article-meta"><li> <span class="label">发布:</span> <a href="/image-filters-by-canvas-gray.html" class="article-date"><time datetime="2013-11-03T23:43:33.000Z" itemprop="datePublished">2013-11-03</time></a></li><li> <span class="label">分类:</span><div class="article-category"> <a class="article-category-link" href="/category/前端设计/">前端设计</a></div></li><li> <span class="label">标签:</span><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Canvas/">Canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/HTML5/">HTML5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/图像滤镜/">图像滤镜</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/滤镜/">滤镜</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/灰度滤镜/">灰度滤镜</a></li></ul></li><hr></ul></footer></div><nav id="article-nav" class="article-nav"> <a href="/image-filters-by-canvas-video.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title"> 用Canvas实现图片滤镜效果详解之视频效果</div></a> <a href="/image-filters-by-canvas.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">用Canvas实现图片滤镜效果</div></a></nav></article><aside id="article-toc" role="navigation" class="article-toc"><div id="article-toc-inner"> <strong class="sidebar-title">目录</strong><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-获取图像数据"><span class="toc-text">1.获取图像数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-通过灰度算法处理图像数据"><span class="toc-text">2.通过灰度算法处理图像数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-把新的图像数据写入canvas"><span class="toc-text">3.把新的图像数据写入canvas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-效果预览"><span class="toc-text">4.效果预览</span></a></li></ol> <a href="#" id="article-toc-top">回到顶部</a></div></aside><section id="gitment_ccomments" class="comments"><div id="gitment_container"></div></section></div></section></div><footer id="footer" class="post-footer footer"><div id="footerContent" class="footer-content"><div class="end-of-file">Live Happy Love Hard</div></div></footer></div><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/gitment.js"></script><script>var date="Sun Nov 03 2013 23:43:33 GMT+0000",id=""+new Date(date).getTime(),gitment=new Gitment({id:id,owner:"summerandwinter",repo:"summerandwinter.github.io",oauth:{client_id:"7b432b7b46e71966fd88",client_secret:"2c697bec7b012bca975de41c87863d84086f8d81"}});gitment.render("gitment_container")</script><script src="//cdn.jsdelivr.net/gh/summerandwinter/summerandwinter.github.io/js/summer.js"></script><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--></div></body>